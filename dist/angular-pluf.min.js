"use strict";angular.module("pluf",[]).run(["$usr","$act","PException",function(a,b,c){b.command({id:"pluf.user.login",label:"login",description:"login a user",visible:function(){return a.isAnonymous()},category:"usr"}).handler({commandId:"pluf.user.login",handle:function(){if(arguments.length<1)throw new c("no credentioal");var b=arguments[0];return a.login(b.username,b.password)}}).command({id:"pluf.user.logout",label:"logout",description:"logout the user",visible:function(){return!a.isAnonymous()},category:"usr"}).handler({commandId:"pluf.user.logout",handle:function(){return a.logout()}}).command({id:"pluf.user.update",label:"update",description:"update the current user",visible:function(){return!a.isAnonymous()}}).handler({commandId:"pluf.user.update",handle:function(){if(arguments.length<1)throw new c("bad param");var b=arguments[0];return a.session().then(function(a){return a.update(b.key,b.value)})}}).command({id:"pluf.user.profile.update",label:"update profile",description:"update user profile",visible:function(){return!a.isAnonymous()}}).handler({commandId:"pluf.user.profile.update",handle:function(){if(arguments.length<1)throw new c("bad param");var b=arguments[0];return a.session().then(function(a){return a.profile()}).then(function(a){return a.update(b.key,b.value)})}})}]),angular.module("pluf").factory("PCommand",function(){var a=function(a){this.priority=0,this.tags=[],a&&this.setData(a),this.handlers=[],"visible"in a||(this.visible=function(){return!0}),"enable"in a||(this.enable=function(){return!0})};return a.prototype.setData=function(a){return angular.extend(this,a),this},a.prototype.handler=function(a){return this.handlers.push(a),this},a.prototype.tag=function(a){this.tags.push(a)},a}),angular.module("pluf").factory("PContent",["$http","$httpParamSerializerJQLike","$q","PObject",function(a,b,c,d){var e=function(){d.apply(this,arguments)};return e.prototype=new d,e.prototype.update=function(){},e.prototype.remove=function(){},e.prototype.value=function(){return a({method:"GET",url:"/api/saascms/content/"+this.id+"/download"}).then(function(a){return a.data})},e.prototype.setValue=function(b){var c=this;return a({method:"POST",url:"/api/saascms/content/"+this.id+"/download",data:b}).then(function(){return c})},e}]),angular.module("pluf").factory("PException",["PObject",function(a){var b=function(){a.apply(this,arguments)};return b.prototype=new a,b}]),angular.module("pluf").factory("PHandler",function(){var a=function(a){this.priority=0,a&&this.setData(a)};return a.prototype.setData=function(a){return angular.extend(this,a),this},a}),angular.module("pluf").factory("PMenu",function(){var a=function(a){this.priority=0,this.tags=[],a&&this.setData(a),this.items=[]};return a.prototype.setData=function(a){return angular.extend(this,a),this},a.prototype.item=function(a){return this.items.push(a),this},a.prototype.tag=function(a){this.tags.push(a)},a}),angular.module("pluf").factory("PMenuItem",["$window","$act",function(a,b){var c=function(a){this.priority=0,this.tags=[],a&&this.setData(a)};return c.prototype.setData=function(a){if("command"in a){var c=this;b.getCommand(a.command).then(function(b){angular.extend(c,b),angular.extend(c,a)})}else angular.extend(this,a);return this},c.prototype.tag=function(a){this.tags.push(a)},c.prototype.active=function(){if("command"in this){var c=[this.command];return this.params instanceof Array&&(c=c.concat(this.params)),b.execute.apply(b,c)}if("action"in this)return this.action();if("link"in this)return void(a.location=this.link);throw{status:404,code:523,message:"Menu item is not supported"}},c}]),angular.module("pluf").factory("PMessage",function(){var a=function(a){a&&this.setData(a)};return a.prototype.setData=function(a){return angular.extend(this,a),this},a.prototype.isInfo=function(){return"info"===this.type},a.prototype.isDebug=function(){return"debug"===this.type},a.prototype.isWarning=function(){return"warning"===this.type},a.prototype.isError=function(){return"error"===this.type},a}),angular.module("pluf").factory("PNamedContent",["$http","$httpParamSerializerJQLike","$q","PObject",function(a,b,c,d){var e=function(){d.apply(this,arguments)};return e.prototype=new d,e.prototype.update=function(){},e.prototype.remove=function(){},e.prototype.value=function(){return this.content.value()},e.prototype.setValue=function(a){return this.content.setValue(a)},e}]),angular.module("pluf").factory("PObject",function(){var a=function(a){a&&this.setData(a)};return a.prototype={setData:function(a){angular.extend(this,a)},isAnonymous:function(){return!(this.id&&this.id>0)}},a}),angular.module("pluf").factory("PaginatorPage",["PObject",function(a){var b=function(){a.apply(this,arguments)};return b.prototype=new a,b.prototype.hasMorePage=function(){return this.response&&this.response.current_page<this.response.page_number},b}]),angular.module("pluf").factory("PaginatorParameter",function(){var a=function(a){a?this.setData(a):this.setData({})};return a.prototype={param:{},setData:function(a){this.param=a},setSize:function(a){return this.param._px_c=a,this},setQuery:function(a){return this.param._px_q=a,this},setPage:function(a){return this.param._px_p=a,this},nextPage:function(){return this.param._px_p+=1,this},setOrder:function(a,b){return this.param._px_sk=a,this.param._px_so=b,this},setFilter:function(a,b){return this.param._px_fk=a,this.param._px_fv=b,this},getParameter:function(){return this.param}},a}),angular.module("pluf").factory("PPreferenceNode",["PObject","$q","$timeout",function(a,b,c){var d=function(){a.apply(this,arguments)};return d.prototype=new a,d.prototype.newNode=function(a){var d=b.defer();return c(function(){d.reject(a)},1),d.promise},d.prototype.node=function(){},d.prototype.nodes=function(){},d.prototype.parent=function(){},d}]),angular.module("pluf").factory("PPreferenceProperty",["PPreferenceNode",function(a){var b=function(){a.apply(this,arguments)};return b.prototype=new a,b.prototype.setValue=function(){},b.prototype.value=function(){},b}]),angular.module("pluf").factory("PProcess",["PObject",function(a){var b=function(){a.apply(this,arguments),this.progress||(this.progress={})};return b.prototype.OK=0,b.prototype.INFO=1,b.prototype.WARNING=2,b.prototype.ERROR=4,b.prototype.CANCEL=8,b.prototype.setWorked=function(a){return this.progress.worked=a,this},b.prototype.worked=function(){return this.progress.worked},b.prototype.addWorked=function(a){return this.progress.worked?this.progress.worked+=a:this.progress.worked=a,this},b.prototype.setTotalWork=function(a){return this.progress.totalWorked=a,this},b.prototype.totalWork=function(){return this.progress.totalWorked},b.prototype.percentage=function(){return this.progress.totalWorked<=0?0:100*this.progress.worked/this.progress.worked},b.prototype.setTaskName=function(a){return this.progress.taskName=a,this},b.prototype.taskName=function(){return this.progress.taskName},b.prototype.setSubTask=function(a){return this.progress.subTask=a,this},b.prototype.subTask=function(){return this.progress.subTask},b}]),angular.module("pluf").factory("PProfile",["$http","$httpParamSerializerJQLike","$q","PObject",function(a,b,c,d){var e=function(a){a&&this.setData(a)};return e.prototype=new d,e.prototype.update=function(){if(this.user.isAnonymous()){var d=c.defer();return d.reject(),d.promise}var e=this;return a({method:"POST",url:"/api/user/"+this.user.id+"/profile",data:b(e),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return e.setData(a.data),e})},e.prototype.remove=function(){var c=this;return a({method:"DELETE",url:"/api/user/"+this.user+"/profile",data:b(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return c.setData(a.data),c})},e}]),angular.module("pluf").factory("PUser",["$http","$q","$httpParamSerializerJQLike","PObject","PProfile",function(a,b,c,d,e){var f=function(a){a&&this.setData(a)};return f.prototype=new d,f.prototype.update=function(){var b=this;return a({method:"POST",url:"/api/user/"+this.id+"/account",data:c(b),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return b.setData(a.data),b})},f.prototype.remove=function(){var b=this;return a({method:"DELETE",url:"/api/user/"+this.id+"/account",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return b.setData(a.data),b})},f.prototype.profile=function(){var c;if(this.isAnonymous())return c=b.defer(),c.reject(),c.promise;if(this._prof&&!this._prof.isAnonymous())return c=b.defer(),c.resolve(this._prof),c.promise;var d=this;return a({method:"GET",url:"/api/user/"+this.id+"/profile"}).then(function(a){return d._prof=new e(a.data),d._prof.user=d,d._prof})},f.prototype.isAdministrator=function(){return this.id&&this.id>0&&this.administrator},f.prototype.isStaff=function(){return this.id&&this.id>0&&this.staff},f}]),angular.module("pluf").service("$act",["$q","$timeout","PCommand","PHandler",function(a,b,c,d){this._commands=[],this.getCommand=function(c){var d=a.defer(),e=this;return b(function(){return c in e._commands?void d.resolve(e._commands[c]):void d.reject({status:404,code:10,message:"command not found"})},1),d.promise},this.command=function(a){if(!a.id)throw{status:404,code:11,message:"Command id is empty"};var b;return b=a.id in this._commands?this._commands[a.id]:new c(a),this._commands[b.id]=b,this},this.handler=function(a){var b;return a.id in this._commands?b=this._commands[a.id]:(b=new c(a),this._commands[b.id]=b),b.handler(new d(a)),this},this.execute=function(c){var d=a.defer();if(c in this._commands){var e=this,f=Array.prototype.slice.call(arguments).slice(1);return b(function(){var a=e._commands[c];a.handlers.forEach(function(a){a.handle.apply(a,f)}),d.resolve()},1),d.promise}return d.reject({message:"Command not found :"+c,statuse:400,code:4404}),d.promise}}]),angular.module("pluf").service("$cms",["$http","$httpParamSerializerJQLike","$q","$timeout","PContent","PNamedContent","PaginatorPage","PException",function(a,b,c,d,e,f,g,h){this._nc={},this._getnc=function(a){return this._nc[a]},this._retnc=function(a,b){var c=this._nc[a];return c?c.setData(b):(c=new f(b),this._nc[a]=c),c},this._c={},this._getc=function(a){return this._c[a]},this._retc=function(a,b){var c=this._c[a];return c?c.setData(b):(c=new e(b),this._c[b.id]=c),c},this.newContent=function(c){var d=this;return a({method:"POST",url:"/api/saascms/content/new",data:b(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return d._retc(a.data.id,a.data)})},this.content=function(b){var d=this._getc(b);if(d){var e=c.defer();return e.resolve(d),e.promise}return d=this,a({method:"GET",url:"/api/saascms/content/"+b}).then(function(a){return d._retc(b,a.data)})},this.contents=function(b){var c=this;return a({method:"GET",url:"/api/saascms/content/find",params:b.getParameter()}).then(function(a){var b=new g(a.data);b.items=[];for(var d=0;d<a.data.counts;d++)b.items.push(c._retc(a.data.items[d].id,a.data.items[d]));return b},function(a){throw new h(a)})},this.newNamedContent=function(c,d){var e,f=this;return a({method:"POST",url:"/api/saascms/page/new",data:b({content:d.id,name:c}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return e=f._retnc(a.data.name,a.data),f.content(e.content)}).then(function(a){return e.content=a,e})},this.namedContent=function(b){var d=this._getnc(b);if(d){var e=c.defer();return e.resolve(d),e.promise}var f,g=this;return a({method:"GET",url:"/api/saascms/page/"+b}).then(function(a){return f=g._retnc(a.data.name,a.data),g.content(f.content)}).then(function(a){return f.content=a,f})},this.namedContents=function(b){var c=this;return a({method:"GET",url:"/api/saascms/page/find",params:b.getParameter()}).then(function(a){var b=new g(a.data);b.items=[];for(var d=0;d<a.data.counts;d++)b.items.push(c._retnc(a.data.items[d].name,a.data.items[d]));return b})}}]),angular.module("pluf").service("$menu",["$q","$timeout","PMenu","PMenuItem",function(a,b,c,d){this.menus=[],this._addMenu=function(a,b){a in this.menus||(this.menus[a]=new c({id:a})),this.menus[a].item(b)},this.menu=function(d){var e=a.defer(),f=this;return b(function(){d in f.menus||(f.menus[d]=new c({id:d})),e.resolve(f.menus[d])},1),e.promise},this.addItem=function(a,b){return this._addMenu(a,new d(b)),this}}]),angular.module("pluf").service("$notify",["$rootScope","$timeout","$q","PMessage",function(a,b,c,d){this._listeners=[],this._fire=function(a,e){var f=c.defer(),g=[];return g.push(new d(e)),b(function(){for(var b=0;b<a.length;b++)a[b].apply(a[b],g);f.resolve()},10),f.promise},this.onMessage=function(a){return this._listeners.push(a),this},this.info=function(a){return a.type="info",this._fire(this._listeners,a)},this.warning=function(a){return a.type="warning",this._fire(this._listeners,a)},this.debug=function(a){return a.type="debug",this._fire(this._listeners,a)},this.error=function(a){return a.type="error",this._fire(this._listeners,a)}}]),angular.module("pluf").service("$preference",function(){this.newNode=function(){},this.node=function(){},this.nodes=function(){}}),angular.module("pluf").service("$process",function(){this.processes=function(){},this.process=function(){}}),angular.module("pluf").service("$usr",["$http","$httpParamSerializerJQLike","$q","$act","PUser","PaginatorPage","PException",function(a,b,c,d,e,f,g){this._su=new e,this._u={},this._getUser=function(a){return this._u[a]&&!this._u[a].isAnonymous()?this._u[a]:null},this._ret=function(a,b){var c=this._getUser(a);return c?c.setData(b):(c=new e(b),this._u[a]=c),c},this.isAnonymous=function(){return this._su.isAnonymous()},this.isAdministrator=function(){return this._su.isAdministrator()},this.login=function(d){if(!this.isAnonymous()){var f=c.defer();return f.resolve(this),f.promise}var g=this;return a({method:"POST",url:"/api/user/login",data:b(d),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return g._su=new e(a.data),g._su})},this.session=function(){var b=this;if(!this.isAnonymous()){var d=c.defer();return d.resolve(this._su),d.promise}return a.get("/api/user/account").then(function(a){return b._su=new e(a.data),b._su})},this.logout=function(){if(this.isAnonymous()){var b=c.defer();return b.resolve(this._su),b.promise}var d=this;return a({method:"POST",url:"/api/user/logout"}).then(function(a){return d._su=new e(a.data),d._su})},this.signup=function(c){return a({method:"POST",url:"/api/user/signup",data:b(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){var b=new e(a.data);return b})},this.users=function(b){var c=this;return a({method:"GET",url:"/api/user/find",params:b.getParameter()}).then(function(a){for(var b=new f(a.data),d=[],e=0;e<b.counts;e++){var g=c._ret(b.items[e].id,b.items[e]);d.push(g)}return b.items=d,b})},this.updateCurrentUser=function(){if(!this.isAnonymous()){var d=c.defer();return d.resolve(this),d.promise}var f=this;return a({method:"POST",url:"/api/user/"+f._su.id+"/account",data:b(f._su),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){var b=new e(a.data);return b},function(a){throw new g(a)})},this.getUser=function(b){var c=this;return a({method:"GET",url:"/api/user/"+b+"/account"}).then(function(a){return c._ret(a.data.id,a.data)})},this.updateUser=function(c,d){return a({method:"POST",url:"/api/user/"+c+"/account",data:b(d),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){var b=new e(a.data);return b},function(a){throw new g(a)})},this.removeUser=function(b){return a({method:"DELETE",url:"/api/user/"+b+"/account",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){var b=new e(a.data);return b},function(a){throw new g(a)})},this.user=function(b){var c=this;return a({method:"GET",url:"/api/user/user/"+b}).then(function(a){return c._ret(a.data.id,a.data)})}}]),angular.module("pluf.saas",["pluf"]).run(["$window","$act","$saas","PException",function(a,b,c,d){b.command({id:"pluf.saas.lunch",category:"saas"}).handler({commandId:"pluf.saas.lunch",handle:function(){if(arguments.length<1)throw new d("no app found");var a=arguments[0];return c.get(a).then(function(a){return a.defaultApplication()}).then(function(a){return a.run()})}}).command({id:"pluf.saas.app.lunch",category:"saas"}).handler({commandId:"pluf.saas.app.lunch",handle:function(){if(arguments.length<1)throw new d("no app found");var a=arguments[0];return c.session().then(function(b){return b.app(a)}).then(function(a){return a.run()})}})}]),angular.module("pluf.saas").factory("PSpa",["$http","$q","$window","PSpaDetail","PObject",function(a,b,c,d,e){var f=function(){e.apply(this,arguments)};return f.prototype=new e,f.prototype.setTenant=function(a){return this._tenant=a,this},f.prototype.reload=function(){},f.prototype.update=function(){},f.prototype["delete"]=function(){},f.prototype.detail=function(){if(this._detail){var c=b.defer();return c.resolve(this._detail),c.promise}var e=this;return a({method:"GET",url:"/api/saas/spa/"+this.id+"/detail"}).then(function(a){return e._detail=new d(a.data),e._detail})},f.prototype.run=function(){c.location=c.location.origin+"/"+this._tenant.id+"/"+this.id},f}]),angular.module("pluf.saas").factory("PSpaDetail",["$http","$q","$window","PObject",function(a,b,c,d){var e=function(){d.apply(this,arguments)};return e.prototype=new d,e}]),angular.module("pluf.saas").factory("PTenant",["$http","$httpParamSerializerJQLike","$window","$q","PObject","PException","PProfile","PaginatorParameter","PaginatorPage","PSpa",function(a,b,c,d,e,f,g,h,i,j){var k=function(){e.apply(this,arguments)};return k.prototype=new e,k.prototype._spa=[],k.prototype._retSpa=function(a){var b;return a.id in this._spa?(b=this._spa[a.id],b.setData(a),b):(b=new j(a).setTenant(this),this._spa[b.id]=b,b)},k.prototype["delete"]=function(){},k.prototype.update=function(){var c=this;return a({method:"POST",url:"/api/saas/"+this.id,data:b(this),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return c.setData(a.data),c})},k.prototype.setting=function(){},k.prototype.config=function(){},k.prototype.members=function(){if(this.isAnonymous()||this.memberLoaded()){var b=d.defer();return this.isAnonymous()?b.reject("authentication requried"):b.resolve(this._member),b.promise}var c=this;return a({method:"GET",url:"/api/saas/app/"+this.id+"/member/list"}).then(function(a){return c.$member.setData(a.data),c.$member},function(a){throw new f(a)})},k.prototype.groups=function(){},k.prototype.group=function(){},k.prototype.accesses=function(){},k.prototype.access=function(){},k.prototype.newAccess=function(){},k.prototype.spas=function(b){b||(b=new h);var c=this;return a({method:"GET",url:"/api/"+this.id+"/saas/spa/find",params:b.getParameter()}).then(function(a){for(var b=new i(a.data),d=[],e=0;e<b.counts;e++){var f=c.ret(b.items[e]);d.push(f)}return b.items=d,b},function(a){throw new f(a)})},k.prototype.spa=function(b){var c=this;return a({method:"GET",url:"/api/saas/spa/"+b}).then(function(a){return c._regSpa(a.data)})},k.prototype.newSpa=function(){},k.prototype["goto"]=function(){c.location=c.location.origin+"/"+this.id},k}]),angular.module("pluf.saas").factory("PTenantGroup",["$http","$q","$window","PObject",function(a,b,c,d){var e=function(){d.apply(this,arguments)};return e.prototype=new d,e}]),angular.module("pluf.saas").factory("PTenantSetting",["$http","$q","$window","PObject",function(a,b,c,d){var e=function(){d.apply(this,arguments)};return e.prototype=new d,e}]),angular.module("pluf.saas").service("$saas",["$http","$httpParamSerializerJQLike","$q","$window","$act","$usr","PTenant","PSpa","PException","PaginatorParameter","PaginatorPage",function(a,b,c,d,e,f,g,h,i,j,k){this._tenant=[],this._retTenant=function(a){var b;return a.id in this._tenant?(b=this._tenant[a.id],b.setData(a),b):(b=new g(a),this._tenant[b.id]=b,b)},this._spa=[],this._retSpa=function(a){var b;return a.id in this._spa?(b=this._spa[a.id],b.setData(a),b):(b=new h(a),this._tenant[b.id]=b,b)},this.session=function(){var b=this;return a.get("/api/saas/tenant").then(function(a){return b.ret(a.data)})},this.mine=function(b){b||(b=new j);var c=this;return a({method:"GET",url:"/api/saas/app/userList",params:b.getParameter()}).then(function(a){var b=new k(a.data);b.items=[];for(var d=0;d<b.counts;d++){var e=c.ret(a.data.items[d]);b.items.push(e)}return b})},this.tenants=function(b){var c=this;return a({method:"GET",url:"/api/saas/tenant/find",params:b.getParameter()}).then(function(a){var b=new k(a.data);b.items=[];for(var d=0;d<b.counts;d++){var e=c.ret(a.data.items[d]);b.items.push(e)}return b},function(a){throw new i(a)})},this.tenant=function(b){var c=this;return a.get("/api/saas/app/"+b).then(function(a){return c.ret(a.data)},function(a){throw new i(a.data)})},this.newTenant=function(c){var d=this;return a({method:"POST",url:"/api/saas/app/create?XDEBUG_SESSION_START=ECLIPSE_DBGP&KEY=14513358957011",data:b(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return d.ret(a.data)},function(a){throw new i(a.data)})},this.spas=function(){},this.spa=function(){},this.newSpa=function(){}}]),function(){angular.module("pluf.social",["pluf"])}(),angular.module("pluf.social").factory("PFollower",["PObject",function(a){var b=function(){a.apply(this,arguments)};return b.prototype=new a,b}]),angular.module("pluf.social").service("$news",["$httpParamSerializerJQLike","$http","$q","PException","PFollower","PaginatorPage",function(a,b,c,d,e,f){this._df=[],this._getf=function(a){return this._df[a]},this._retf=function(a,b){var c=this._getf(a);return c?(c.setData(b),c):(this._df[a]=new e(b),this._df[a])},this.validateFollower=function(a){var b=c.defer(),d=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(d.test(a))return b.resolve({type:"email",address:a}),b.promise;var e=/^\+?\d{10,14}$/;return e.test(a)?(b.resolve({type:"mobile",address:a}),b.promise):(b.resolve({type:"other",address:a}),b.promise)},this.newFollower=function(c){var d=this;return b({method:"POST",url:"/api/newspaper/follower/new",data:a(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return d._retf(a.data.id,a.data)})},this.followers=function(a){var c=this;return b({method:"GET",url:"/api/newspaper/follower/find",params:a.getParameter()}).then(function(a){var b=new f(a.data);b.items=[];for(var d=0;d<a.data.counts;d++)b.items.push(c._retf(a.data.items[d].id,a.data.items[d]));return b})},this.follower=function(){}}]),angular.module("pluf.wiki",["pluf"]),angular.module("pluf.wiki").factory("PWikiBook",["PObject","PException","PWikiPageItem","PaginatorPage","$http","$httpParamSerializerJQLike","$q","$timeout",function(a,b,c,d,e,f,g,h){var i=function(){a.apply(this,arguments)};return i.prototype=new a,i.prototype._retItem=function(a,b){var d=null;for(var e in this.items)if(this.items[e].id===a){d=this.items[e];break}return d||(d=new c(b),this.items.push(d)),d.setData(b),d},i.prototype.firstPage=function(){var a=g.defer(),b=this;return h(function(){a.resolve(b.items[0])},1),a.promise},i.prototype.pages=function(){var a=this;return e({method:"GET",url:"/api/wiki/book/"+a.id+"/pages"}).then(function(b){a.items=[];for(var c=0;c<b.data.length;c++)a._retItem(b.data[c].id,b.data[c]);return a.items},function(a){throw new b(a)})},i.prototype.addPage=function(a){if(a.isAnonymous()){var c=g.defer();return h(function(){var a=new b({message:"Page id is null!"});c.reject(a)},1),c.promise}var d=this;return e({method:"POST",url:"/api/wiki/book/"+d.id+"/page/"+a.id}).then(function(){return d})},i.prototype.removePage=function(a){if(a.isAnonymous()){var c=g.defer();return h(function(){var a=new b({message:"Page id is null!"});c.reject(a)},1),c.promise}var d=this;return e({method:"DELETE",url:"/api/wiki/book/"+d.id+"/page/"+a.id}).then(function(){return d})},i.prototype.update=function(a){var c=this;return e({method:"POST",url:"/api/wiki/book/"+c.id,data:f(a),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return c.setData(a.data),c},function(a){throw new b(a)})},i.prototype.remove=function(){var a=this;return e({method:"DELETE",url:"/api/wiki/book/"+a.id}).then(function(b){return a.setData(b.data),a},function(a){throw new b(a)})},i}]),angular.module("pluf.wiki").factory("PWikiPage",["$http","$httpParamSerializerJQLike","PException","PObject",function(a,b,c,d){var e=function(a){a&&this.setData(a)};return e.prototype=new d,e.prototype.update=function(){var d=this;return a({method:"POST",url:"/api/wiki/page/"+this.id,data:b(d),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return d.setData(a.data),d},function(a){throw new c(a)})},e.prototype.remove=function(){var b=this;return a({method:"DELETE",url:"/api/wiki/page/"+b.id}).then(function(a){return b.setData(a.data),b},function(a){throw new c(a)})},e.prototype.toHTML=function(){return markdown.toHTML(this.content)},e}]),angular.module("pluf.wiki").factory("PWikiPageItem",["PObject",function(a){var b=function(a){a&&this.setData(a)};return b.prototype=new a,b.prototype.page=function(){},b}]),angular.module("pluf.wiki").filter("unsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),angular.module("pluf.wiki").service("$help",["$http","$httpParamSerializerJQLike","$q","PException","PWikiPage","PWikiBook","PaginatorPage",function(a,b,c,d,e,f,g){this._ppage={},this._getPage=function(a){return this._ppage[a]},this._setPage=function(a){this._ppage[a.id]=a},this._retPage=function(a,b){var c=this._getPage(a);return c?c.setData(b):(c=new e(b),this._setPage(c)),c},this._pbook={},this._getBook=function(a){return this._pbook[a]},this._setBook=function(a){this._pbook[a.id]=a},this._retBook=function(a,b){var c=this._getBook(a);return c?c.setData(b):(c=new f(b),this._setBook(c)),c},this.books=function(b){var c=this;return a({method:"GET",url:"/api/wiki/book/find",params:b.getParameter()}).then(function(a){for(var b=new g(a.data),d=[],e=0;e<b.counts;e++){var f=c._retBook(b.items[e].id,b.items[e]);d.push(f)}return b.items=d,b},function(a){throw new d(a)})},this.book=function(b){var c=this;return a({method:"GET",url:"/api/wiki/book/"+b}).then(function(a){var b=c._retBook(a.data.id,a.data);return b},function(a){throw new d(a)})},this.createBook=function(c){var e=this;return a({method:"POST",url:"/api/wiki/book/create",data:b(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){var b=e._retBook(a.data.id,a.data);return b},function(a){throw new d(a)})},this.pages=function(b){var c=this;return a({method:"GET",url:"/api/wiki/page/find",params:b.getParameter()}).then(function(a){for(var b=new g(a.data),d=[],e=0;e<b.counts;e++){var f=c._retPage(b.items[e].id,b.items[e]);d.push(f)}return b.items=d,b},function(a){throw new d(a)})},this.page=function(b){var c=this;return a({method:"GET",url:"/api/wiki/page/"+b}).then(function(a){var b=c._retPage(a.data.id,a.data);return b},function(a){throw new d(a)})},this.createPage=function(c){var e=this;return a({method:"POST",url:"/api/wiki/page/create",data:b(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){var b=e._retPage(a.data.id,a.data);return b},function(a){throw new d(a)})}}]);