"use strict";angular.module("pluf",[]),angular.module("pluf").factory("PBank",["PObject","$pluf",function(a,b){var c=function(){a.apply(this,arguments)};return c.prototype=new a,c.prototype.update=b.createUpdate({method:"POST",url:"/api/bank/engine/:id"}),c.prototype.remove=b.createDelete({method:"DELETE",url:"/api/bank/engine/:id"}),c}]),angular.module("pluf").factory("PGate",["PObject","$pluf",function(a,b){var c=function(){a.apply(this,arguments)};return c.prototype=new a,c.prototype.update=b.createUpdate({method:"POST",url:"/api/bank/backend/:id"}),c.prototype.remove=b.createDelete({method:"DELETE",url:"/api/bank/backend/:id"}),c.prototype["delete"]=c.prototype.remove,c}]),angular.module("pluf").factory("PReceipt",["PObject","$pluf",function(a,b){var c=function(){a.apply(this,arguments)};return c.prototype=new a,c.prototype.update=b.createUpdate({method:"POST",url:"/api/bank/receipt/:id"}),c.prototype.remove=b.createDelete({method:"DELETE",url:"/api/bank/receipt/:id"}),c.prototype["delete"]=c.prototype.remove,c}]),angular.module("pluf").service("$bank",["$pluf","PBank","PGate","PReceipt","PObjectCache",function(a,b,c,d,e){var f=new e(function(a){return new b(a)}),g=new e(function(a){return new c(a)}),h=new e(function(a){return new d(a)});this.newReceipt=a.createNew({method:"POST",url:"/api/bank/receipt/new"},h),this.receipt=a.createGet({method:"GET",url:"/api/bank/receipt/{id}"},h),this.receipts=a.createFind({method:"GET",url:"/api/bank/receipt/find"},h),this.newGate=a.createNew({method:"POST",url:"/api/bank/backend/new"},g),this.gateProperty=a.get({url:"/api/bank/backend/new"}),this.gate=a.createGet({method:"GET",url:"/api/bank/backend/{id}"},g),this.gates=a.createFind({method:"GET",url:"/api/bank/backend/find"},g),this.bank=a.createGet({method:"GET",url:"/api/bank/engine/{id}"},f),this.banks=a.createFind({method:"GET",url:"/api/bank/engine/find"},f)}]),angular.module("pluf").factory("PBook",["PObject","PaginatorPage","$http","$httpParamSerializerJQLike","$q","PPage",function(a,b,c,d,e,f){var g=function(){a.apply(this,arguments)};return g.prototype=new a,g.prototype.pages=function(){return c({method:"GET",url:"/api/book/"+this.id+"/page/find"}).then(function(a){for(var c=new b(a.data),d=[],e=0;e<c.counts;e++){var g=c.items[e];d.push(new f(g))}return c.items=d,c})},g.prototype.newPage=function(a){return c({method:"POST",url:"/api/book/"+this.id+"/page/new",data:d(a)}).then(function(a){return new f(a.data)})},g.prototype.page=function(a){return c({method:"GET",url:"/api/book/"+this.id+"/page/"+a}).then(function(a){return new f(a.data)})},g.prototype.update=function(){var a=this;return c({method:"POST",url:"/api/book/"+a.id,data:d(this),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(b){return a.setData(b.data),a})},g.prototype.remove=function(){var a=this;return c({method:"DELETE",url:"/api/book/"+a.id}).then(function(b){return a.setData(b.data),a})},g}]),angular.module("pluf").factory("PPage",["$http","$httpParamSerializerJQLike","PObject",function(a,b,c){var d=function(a){a&&this.setData(a)};return d.prototype=new c,d.prototype.update=function(){var c=this;return a({method:"POST",url:"/api/book/"+this.book+"/page/"+this.id,data:b(this),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return c.setData(a.data),c})},d.prototype.remove=function(){var b=this;return a({method:"DELETE",url:"/api/book/"+this.book+"/page/"+this.id}).then(function(a){return b.setData(a.data),b})},d.prototype.toHTML=function(){return markdown.toHTML(this.content)},d}]),angular.module("pluf").service("$book",["$http","$httpParamSerializerJQLike","$q","PBook","PaginatorPage","PObjectCache",function(a,b,c,d,e,f){var g="application/x-www-form-urlencoded",h=new f(function(a){return new d(a)});this._cache=h,this.books=function(b){var c={};return b&&(c=b.getParameter()),a({method:"GET",url:"/api/book/find",params:b}).then(function(a){for(var b=new e(a.data),c=[],d=0;d<b.counts;d++){var f=b.items[d];f=h.restor(f.id,f),c.push(f)}return b.items=c,b})},this.book=function(b){if(h.contains(b)){var d=c.defer();return d.resolve(h.get(b)),d.promise}return a({method:"GET",url:"/api/book/"+b}).then(function(a){return h.restor(a.data.id,a.data)})},this.newBook=function(c){return a({method:"POST",url:"/api/book/new",data:b(c),headers:{"Content-Type":g}}).then(function(a){return h.restor(a.data.id,a.data)})}}]),angular.module("pluf").filter("unsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),angular.module("pluf").factory("PCalendar",["PObject","$pluf","PObjectFactory",function(a,b,c){var d=new c(function(a){return this.PEvent||(this.PEvent=$injector.get("PEvent")),new this.PEvent(a)}),e=function(){a.apply(this,arguments)};return e.prototype=new a,e.prototype.update=b.createUpdate({method:"POST",url:"/api/calendar/calendars/:id"}),e.prototype.remove=b.createDelete({method:"DELETE",url:"/api/calendar/calendars/:id"}),e.prototype["delete"]=e.prototype.remove,e.prototype.events=b.createGet({method:"GET",url:"/api/calendars/calendar/:id/events/find"},d),e.prototype.newGroup=b.createNew({method:"POST",url:"/api/calendars/calendar/:id/events/new"},d),e}]),angular.module("pluf").factory("PEvent",["PObject","$pluf",function(a,b){var c=function(){a.apply(this,arguments)};return c.prototype=new a,c.prototype.update=b.createUpdate({method:"POST",url:"/api/calendar/events/:id"}),c.prototype.remove=b.createDelete({method:"DELETE",url:"/api/calendar/events/:id"}),c.prototype["delete"]=c.prototype.remove,c}]),angular.module("pluf").service("$calendar",["$pluf","PCalendar","PEvent","PObjectCache",function(a,b,c,d){var e=new d(function(a){return new b(a)}),f=new d(function(a){return new c(a)});this.newCalendar=a.createNew({method:"POST",url:"/api/calendar/calendars/new"},e),this.calendar=a.createGet({method:"GET",url:"/api/calendar/calendars/{id}"},e),this.calendars=a.createFind({method:"GET",url:"/api/calendar/calendars/find"},e),this.newEvent=a.createNew({method:"POST",url:"/api/calendar/events/new"},f),this.event=a.createGet({method:"GET",url:"/api/calendar/events/{id}"},f),this.events=a.createFind({method:"GET",url:"/api/calendar/events/find"},f)}]),angular.module("pluf").factory("PContent",["$http","$httpParamSerializerJQLike","$q","PObject",function(a,b,c,d){function e(a){a.link="/api/cms/"+a.id+"/download"}var f=function(){d.apply(this,arguments),e(this)};return f.prototype=new d,f.prototype.update=function(){var c=this;return a({method:"POST",url:"/api/cms/"+this.id,data:b(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return c.setData(a.data),e(c),c})},f.prototype.remove=function(){var b=this;return a({method:"DELETE",url:"/api/cms/"+this.id}).then(function(){return delete b.id,b})},f.prototype["delete"]=f.prototype.remove,f.prototype.value=function(){return a({method:"GET",url:this.link}).then(function(a){return a.data})},f.prototype.setValue=function(b){var c=this;return a({method:"POST",url:this.link,data:b}).then(function(){return c})},f.prototype.upload=function(b){var c=new FormData;return c.append("file",b),a.post(this.link,c,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},f}]),angular.module("pluf").service("$cms",["$http","$httpParamSerializerJQLike","$q","$timeout","PContent","PaginatorPage","PObjectCache","$pluf",function(a,b,c,d,e,f,g,h){var i=new g(function(a){return new e(a)});this._cache=i,this.newContent=h.createNew({method:"POST",url:"/api/cms/new"},i),this.newFileContent=function(b,c){var d=new FormData;for(var e in b)b[e]&&d.append(e,b[e]);return d.append("file",c),a.post("/api/cms/new",d,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(a){return i.restor(a.data.id,a.data)})},this.content=h.createGet({method:"GET",url:"/api/cms/{id}"},i),this.contents=h.createFind({method:"GET",url:"/api/cms/find"},i)}]),angular.module("pluf").factory("PCollection",["PObject","$pluf","PObjectFactory","PDocument",function(a,b,c,d){var e=new c(function(a){return new d(a)}),f=function(){a.apply(this,arguments)};return f.prototype=new a,f.prototype.update=b.createUpdate({method:"POST",url:"/api/collection/:id"}),f.prototype["delete"]=b.createDelete({method:"DELETE",url:"/api/collection/:id"}),f.prototype.documents=b.createFind({method:"GET",url:"/api/collection/:id/document/find"},e),f.prototype.newDocument=b.createNew({method:"POST",url:"/api/collection/:id/document/new"},e),f.prototype.document=b.createGet({method:"GET",url:"/api/collection/:id/document/{id}"},e),f}]),angular.module("pluf").factory("PDocument",["PObject","$pluf",function(a,b){var c=function(){a.apply(this,arguments)};return c.prototype=new a,c.prototype.update=b.createUpdate({method:"POST",url:"/api/collection/:collection/document/:id"}),c.prototype.remove=b.createDelete({method:"DELETE",url:"/api/collection/:collection/document/:id"}),c}]),angular.module("pluf").service("$collection",["$pluf","PCollection","PObjectFactory",function(a,b,c){var d=new c(function(a){return new b(a)});this.newCollection=a.createNew({method:"POST",url:"/api/collection/new"},d),this.collection=a.createGet({method:"GET",url:"/api/collection/{id}"},d),this.collections=a.createFind({method:"GET",url:"/api/collection/find"},d)}]),angular.module("pluf").factory("PCommand",function(){var a=function(a){this.priority=0,this.tags=[],a&&this.setData(a),this.handlers=[],"visible"in a||(this.visible=function(){return!0}),"enable"in a||(this.enable=function(){return!0})};return a.prototype.setData=function(a){return angular.extend(this,a),this},a.prototype.handler=function(a){return this.handlers.push(a),this},a.prototype.tag=function(a){this.tags.push(a)},a}),angular.module("pluf").factory("PException",["PObject",function(a){var b=function(){a.apply(this,arguments)};return b.prototype=new a,b}]),angular.module("pluf").factory("PHandler",function(){var a=function(a){this.priority=0,a&&this.setData(a)};return a.prototype.setData=function(a){return angular.extend(this,a),this},a}),angular.module("pluf").factory("PMenu",function(){var a=function(a){this.priority=0,this.tags=[],a&&this.setData(a),this.items=[]};return a.prototype.setData=function(a){return angular.extend(this,a),this},a.prototype.item=function(a){return this.items.push(a),this},a.prototype.clear=function(){return this.items.splice(0),this},a.prototype.tag=function(a){this.tags.push(a)},a}),angular.module("pluf").factory("PMenuItem",["$window","$act",function(a,b){var c=function(a){this.priority=0,this.tags=[],a&&this.setData(a)};return c.prototype.setData=function(a){if("command"in a){var c=this;b.getCommand(a.command).then(function(b){angular.extend(c,b),angular.extend(c,a)})}else angular.extend(this,a);return this},c.prototype.tag=function(a){this.tags.push(a)},c.prototype.active=function(){if("command"in this){var c=[this.command];return this.params instanceof Array&&(c=c.concat(this.params)),b.execute.apply(b,c)}if("action"in this)return this.action();if("link"in this)return void(a.location=this.link);throw{status:404,code:523,message:"Menu item is not supported"}},c}]),angular.module("pluf").factory("PMessage",function(){var a=function(a){a&&this.setData(a)};return a.prototype.setData=function(a){return angular.extend(this,a),this},a.prototype.isInfo=function(){return"info"===this.type},a.prototype.isDebug=function(){return"debug"===this.type},a.prototype.isWarning=function(){return"warning"===this.type},a.prototype.isError=function(){return"error"===this.type},a}),angular.module("pluf").factory("PObject",function(){var a=function(a){a&&this.setData(a)};return a.prototype={setData:function(a){angular.extend(this,a)},isAnonymous:function(){return!(this.id&&this.id>0)},isExpired:function(){return!1}},a}),angular.module("pluf").factory("PObjectCache",function(){var a=function(a){this._cache=[],this.factory=a};return a.prototype.get=function(a){return this._cache[a]?this._cache[a].isAnonymous()||this._cache[a].isExpired()?(delete this._cache[a],null):this._cache[a]:null},a.prototype.getObject=a.prototype.get,a.prototype.restor=function(a,b){var c=this.getObject(a);return c?c.setData(b):(c=this.factory(b),this._cache[a]=c),c},a.prototype.contains=function(a){return a in this._cache},a}),angular.module("pluf").factory("PObjectFactory",function(){var a=function(a){this.factory=a};return a.prototype.get=function(){return null},a.prototype.restor=function(a,b){b.id=a;var c=this.factory(b);return c},a.prototype.contains=function(){return!1},a}),angular.module("pluf").factory("PaginatorPage",["PObject",function(a){var b=function(){a.apply(this,arguments)};return b.prototype=new a,b.prototype.hasMore=function(){return this.current_page<this.page_number},b.prototype.isFirst=function(){return 1===this.current_page},b.prototype.next=function(){return this.current_page+1},b.prototype.previous=function(){return this.current_page-1},b}]),angular.module("pluf").factory("PaginatorParameter",function(){var a=function(){this.param={}};return a.prototype={setSize:function(a){return this.param._px_c=a,this},setQuery:function(a){return this.param._px_q=a,this},setPage:function(a){return this.param._px_p=a,this},nextPage:function(){return this.param._px_p+=1,this},setOrder:function(a,b){return this.param._px_sk=a,this.param._px_so=b,this},setFilter:function(a,b){return this.param._px_fk=a,this.param._px_fv=b,this},getParameter:function(){return this.param},put:function(a,b){return this.param[a]=b,this},get:function(a){return this.param[a]}},a}),angular.module("pluf").factory("PPreferenceNode",["PObject","$q","$timeout",function(a,b,c){var d=function(){a.apply(this,arguments)};return d.prototype=new a,d.prototype.newNode=function(a){var d=b.defer();return c(function(){d.reject(a)},1),d.promise},d.prototype.node=function(){},d.prototype.nodes=function(){},d.prototype.parent=function(){},d}]),angular.module("pluf").factory("PPreferenceProperty",["PPreferenceNode",function(a){var b=function(){a.apply(this,arguments)};return b.prototype=new a,b.prototype.setValue=function(){},b.prototype.value=function(){},b}]),angular.module("pluf").factory("PProcess",["PObject",function(a){var b=function(){a.apply(this,arguments),this.progress||(this.progress={})};return b.prototype.OK=0,b.prototype.INFO=1,b.prototype.WARNING=2,b.prototype.ERROR=4,b.prototype.CANCEL=8,b.prototype.setWorked=function(a){return this.progress.worked=a,this},b.prototype.worked=function(){return this.progress.worked},b.prototype.addWorked=function(a){return this.progress.worked?this.progress.worked+=a:this.progress.worked=a,this},b.prototype.setTotalWork=function(a){return this.progress.totalWorked=a,this},b.prototype.totalWork=function(){return this.progress.totalWorked},b.prototype.percentage=function(){return this.progress.totalWorked<=0?0:100*this.progress.worked/this.progress.worked},b.prototype.setTaskName=function(a){return this.progress.taskName=a,this},b.prototype.taskName=function(){return this.progress.taskName},b.prototype.setSubTask=function(a){return this.progress.subTask=a,this},b.prototype.subTask=function(){return this.progress.subTask},b}]),angular.module("pluf").service("$act",["$q","$timeout","PCommand","PHandler",function(a,b,c,d){this._commands=[],this.getCommand=function(c){var d=a.defer(),e=this;return b(function(){return c in e._commands?void d.resolve(e._commands[c]):void d.reject({status:404,code:10,message:"command not found"})},1),d.promise},this.command=function(a){if(!a.id)throw{status:404,code:11,message:"Command id is empty"};var b;return a.id in this._commands?(b=this._commands[a.id],b.setData(a)):(b=new c(a),this._commands[b.id]=b),this},this.handler=function(a){var b;return a.command in this._commands?b=this._commands[a.command]:(b=new c({id:a.command}),this._commands[b.id]=b),b.handler(new d(a)),this},this.execute=function(c){var d=a.defer();if(c in this._commands){var e=this,f=Array.prototype.slice.call(arguments).slice(1);return b(function(){var a=e._commands[c];a.handlers.forEach(function(a){a.handle.apply(a,f)}),d.resolve()},1),d.promise}return d.reject({message:"Command not found :"+c,statuse:400,code:4404}),d.promise}}]),angular.module("pluf").filter("pdate",function(){return function(a,b){try{var c=moment.utc(a).local();return c.format(b)}catch(d){return"-"+d.message}}}),angular.module("pluf").filter("pfromNow",function(){return function(a){var b=moment.utc(a).local();return b.fromNow()}}),angular.module("pluf").filter("punsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),angular.module("pluf").service("$menu",["$q","$timeout","PMenu","PMenuItem",function(a,b,c,d){this.menus=[],this._addMenu=function(a,b){a in this.menus||(this.menus[a]=new c({id:a})),this.menus[a].item(b)},this.menu=function(a){return a in this.menus||(this.menus[a]=new c({id:a})),this.menus[a]},this.addItem=function(a,b){return this._addMenu(a,new d(b)),this}}]),angular.module("pluf").service("$notify",["$rootScope","$timeout","$q","PMessage",function(a,b,c,d){this._listeners=[],this._fire=function(a,e){var f=c.defer(),g=[];return g.push(new d(e)),b(function(){for(var b=0;b<a.length;b++)a[b].apply(a[b],g);f.resolve()},10),f.promise},this.onMessage=function(a){return this._listeners.push(a),this},this.info=function(a){return a.type="info",this._fire(this._listeners,a)},this.warning=function(a){return a.type="warning",this._fire(this._listeners,a)},this.debug=function(a){return a.type="debug",this._fire(this._listeners,a)},this.error=function(a){return a.type="error",this._fire(this._listeners,a)}}]),angular.module("pluf").service("$pluf",["PaginatorPage","$q","$http","$httpParamSerializerJQLike",function(a,b,c,d){function e(a,b){if(0===a.indexOf(":"))return a;for(var c=a.split("/"),d=a,e=0;e<c.length;e++){var f=c[e];if(0===f.indexOf(":")){var g=f.substring(1,f.length);d=d.replace(f,b[g])}}return d}this.createFind=function(b,d){var f=b.url;return function(g){return g&&(b.params=g.getParameter()),b.url=e(f,this),c(b).then(function(b){for(var c=new a(b.data),e=[],f=0;f<c.counts;f++){var g=c.items[f];e.push(d.restor(g.id,g))}return c.items=e,c})}},this.createGet=function(a,d){var f=a.url;return function(g){if(d.contains(g)){var h=b.defer();return h.resolve(d.get(g)),h.promise}var i=e(f,this);return a.url=i.replace("{id}",g),c(a).then(function(a){return d.restor(a.data.id,a.data)})}},this.createUpdate=function(a){a.headers={"Content-Type":"application/x-www-form-urlencoded"};var b=a.url;return function(f){f||(f=this);var g=this;return a.url=e(b,g),a.data=d(f),c(a).then(function(a){return g.setData(a.data),g})}},this.createDelete=function(a){var b=a.url;return function(){var d=this;return a.url=e(b,d),c(a).then(function(a){return d.setData(a.data),d})}},this.createDeleteAss=function(a,b){var d=a.url;return function(f){var g=this;return a.url=e(d,g),f.id&&(a.url=a.url.replace("{id}",f.id)),c(a).then(function(a){return b?b.restor(a.data.id,a.data):a.data})}},this.createNew=function(a,b){a.headers={"Content-Type":"application/x-www-form-urlencoded"};var f=a.url;return function(g){return a.url=e(f,this),a.data=d(g),c(a).then(function(a){return b.restor(a.data.id,a.data)})}},this.get=function(a,b){if(a.method="GET",0===a.url.indexOf(":"))return function(d){return d||(d={}),a.params=d,c(a).then(function(a){return b?b.restor(a.data.id,a.data):a.data})};var d=a.url;return function(f){return f||(f={}),a.url=e(d,this),a.params=f,c(a).then(function(a){return b?b.restor(a.data.id,a.data):a.data})}},this.post=function(a,b){a.method="POST",a.headers={"Content-Type":"application/x-www-form-urlencoded"};var f=a.url;return function(g){return g||(g=this),a.url=e(f,this),a.data=d(g),c(a).then(function(a){return b?b.restor(a.data.id,a.data):a.data})}}}]),angular.module("pluf").service("$preference",function(){this.newNode=function(){},this.node=function(){},this.nodes=function(){}}),angular.module("pluf").service("$process",function(){this.processes=function(){},this.process=function(){}}),angular.module("pluf").factory("PMonitor",["PObject","$rootScope","$http","PaginatorPage","PMonitorProperty",function(a,b,c,d,e){var f=function(){a.apply(this,arguments)};return f.prototype=new a,f.prototype.properties=function(a){var b={method:"GET",url:"/api/monitor/"+this.id+"/property/find"};a&&(b.params=a.getParameter());var f=this;return c(b).then(function(a){for(var b=new d(a.data),c=[],g=0;g<b.counts;g++){var h=b.items[g],i=new e(h);i.monitor=f.id,c.push(i)}return b.items=c,b})},f}]),angular.module("pluf").factory("PMonitorProperty",["PObject","$rootScope","$http","PObjectFactory",function(a,b,c,d){var e=function(){a.apply(this,arguments)};return e.prototype=new a,e.prototype.refresh=function(){var a=this;return this.path||(this.path="/api/monitor/"+this.monitor+"/property/"+this.id),c.get(this.path).then(function(c){return c.data.value!==a.value&&b.$emit(a.path,a.value,c.data.value),a.setData(c.data),a},function(){return a.value&&b.$emit(a.path,a.value,!1),a.setData(!1),a})},e.prototype.watch=function(a){return this.path||(this.path="/api/monitor/"+this.monitor+"/property/"+this.id),b.$on(this.path,a)},e}]),angular.module("pluf").service("$monitor",["$q","$timeout","$pluf","PMonitor","PMonitorProperty","PObjectFactory",function(a,b,c,d,e,f){function g(){if(0==h.length)return void b(g,i);for(var c=[],d=0;d<h.length;d++){var e=h[d];c.push(e.refresh())}return a.all(c)["finally"](function(){b(g,i)})}var h=[],i=6e4,j=new f(function(a){return new this.PMonitor(a)});this.monitor=function(c,d){var f=a.defer();return b(function(){var a=null;return angular.forEach(h,function(b){b.monitor===c&&b.property==d&&(a=b)}),a?void f.resolve(a):(a=new e,a.monitor=c,a.id=d,h.push(a),void f.resolve(a))},1),f.promise},this.monitors=c.createFind({method:"GET",url:"/api/monitor/find"},j),this.distroy=function(c){var d=a.defer();return b(function(){d.resolve(c)},1),d.promise},g(),this.query=c.get({url:"/api/v1/monitor/query"}),this.queryRange=c.get({url:"/api/v1/monitor/query_range"})}]),angular.module("pluf").run(["$act",function(a){a.command({id:"tenant.lunch",category:"saas"}).command({id:"spa.lunch",category:"saas"})}]),angular.module("pluf").run(["$window","$act","$saas","PException",function(a,b,c,d){b.handler({command:"tenant.lunch",handle:function(){if(arguments.length<1)throw new d("tenant not found");var a=arguments[0];return c.get(a).then(function(a){return a.defaultApplication()}).then(function(a){return a.run()})}}).handler({command:"spa.lunch",handle:function(){if(arguments.length<1)throw new d("application not found");var a=arguments[0];return c.session().then(function(b){return b.app(a)}).then(function(a){return a.run()})}})}]),angular.module("pluf").factory("PSetting",["$http","$q","$window","PObject",function(a,b,c,d){var e=function(){d.apply(this,arguments)};return e.prototype=new d,e}]),angular.module("pluf").factory("PSpa",["$pluf","$window","PObject",function(a,b,c){var d=function(){c.apply(this,arguments)};return d.prototype=new c,d.prototype.update=a.createUpdate({method:"POST",url:"/api/spa/:id"}),d.prototype["delete"]=a.createDelete({method:"DELETE",url:"/api/spa/:id"}),d.prototype.states=a.get({url:"/api/spa/:id/states/find"}),d.prototype.run=function(a){var c=b.location.origin+"/"+this.name+"/";a?b.open(c,"_blank"):b.location=c},d}]),angular.module("pluf").factory("PTenant",["$pluf","$injector","PObject",function(a,b,c){var d=function(){c.apply(this,arguments)};return d.prototype=new c,d.prototype["delete"]=a.createDelete({method:"DELETE",url:"/api/tenant/:id"}),d.prototype.update=a.createUpdate({method:"POST",url:"/api/tenant/:id"}),d.prototype.defaultSpa=function(a){var c=b.get("$saas");return c.setting("spa.default",a.name)},d}]),angular.module("pluf").service("$saas",["$http","PTenant","PSpa","PObjectCache","$pluf","$httpParamSerializerJQLike",function(a,b,c,d,e,f){var g=new d(function(a){return new b(a)}),h=new d(function(a){return new c(a)});this.session=function(){return a.get("/api/tenant").then(function(a){return g.restor(a.data.id,a.data)})},this.tenants=e.createFind({method:"GET",url:"/api/tenant/find"},g),this.tenant=e.createGet({url:"/api/tenant/{id}",method:"GET"},g),this.newTenant=e.createNew({method:"POST",url:"/api/tenant/new"},g),this.spas=e.createFind({method:"GET",url:"/api/spa/find"},h),this.spa=e.createGet({url:"/api/spa/{id}",method:"GET"},h),this.newSpa=function(b){var d=new FormData;return d.append("file",b),a.post("/api/spa/new",d,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(a){return new c(a.data)})},this.setting=function(b,c){return angular.isDefined(c)?a({method:"POST",url:"/api/setting/spa.default",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:f({value:c})}):a({method:"GET",url:"/api/setting/spa.default"}).then(function(a){return a.data.value})}}]),angular.module("pluf").factory("PFollower",["PObject",function(a){var b=function(){a.apply(this,arguments)};return b.prototype=new a,b}]),angular.module("pluf").service("$news",["$httpParamSerializerJQLike","$http","$q","PException","PFollower","PaginatorPage",function(a,b,c,d,e,f){this._df=[],this._getf=function(a){return this._df[a]},this._retf=function(a,b){var c=this._getf(a);return c?(c.setData(b),c):(this._df[a]=new e(b),this._df[a])},this.validateFollower=function(a){var b=c.defer(),d=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(d.test(a))return b.resolve({type:"email",address:a}),b.promise;var e=/^\+?\d{10,14}$/;return e.test(a)?(b.resolve({type:"mobile",address:a}),b.promise):(b.resolve({type:"other",address:a}),b.promise)},this.newFollower=function(c){var d=this;return b({method:"POST",url:"/api/newspaper/follower/new",data:a(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return d._retf(a.data.id,a.data)})},this.followers=function(a){var c=this;return b({method:"GET",url:"/api/newspaper/follower/find",params:a.getParameter()}).then(function(a){var b=new f(a.data);b.items=[];for(var d=0;d<a.data.counts;d++)b.items.push(c._retf(a.data.items[d].id,a.data.items[d]));return b})},this.follower=function(){}}]),angular.module("pluf").run(["$usr","$act",function(a,b){b.command({id:"user.logout",label:"logout",description:"logout the user",visible:function(){return!a.isAnonymous()},category:"usr"})}]),angular.module("pluf").run(["$usr","$act",function(a,b){b.handler({commandId:"user.logout",handle:function(){return a.logout()}})}]),angular.module("pluf").factory("PGroup",["PObject","PObjectFactory","$injector","$pluf",function(a,b,c,d){var e=new b(function(a){return this.PRole||(this.PRole=c.get("PRole")),new this.PRole(a)}),f=new b(function(a){return this.PGroup||(this.PUser=c.get("PUser")),new this.PUser(a)}),g=function(a){a&&this.setData(a)};return g.prototype=new a,g.prototype.update=d.createUpdate({method:"POST",url:"/api/group/:id"}),g.prototype.remove=d.createDelete({method:"DELETE",url:"/api/group/:id"}),g.prototype["delete"]=g.prototype.remove,g.prototype.removeRole=d.createDeleteAss({method:"DELETE",url:"/api/group/:id/role/{id}"},e),g.prototype.roles=d.createFind({method:"GET",url:"/api/group/:id/role/find"},e),g.prototype.newRole=d.createNew({method:"POST",url:"/api/group/:id/role/new"},e),g.prototype.removeUser=d.createDeleteAss({method:"DELETE",url:"/api/group/:id/user/{id}"},f),g.prototype.users=d.createFind({method:"GET",url:"/api/group/:id/user/find"},f),g.prototype.newUser=d.createNew({method:"POST",url:"/api/group/:id/user/new"},f),g}]),angular.module("pluf").factory("PUserMessage",["$pluf","PObject",function(a,b){var c=function(a){a&&this.setData(a)};return c.prototype=new b,c.prototype["delete"]=a.createDelete({method:"DELETE",url:"/api/message/:id"}),c}]),angular.module("pluf").factory("PProfile",["$http","$httpParamSerializerJQLike","$q","PObject",function(a,b,c,d){var e=function(a){a&&this.setData(a)};return e.prototype=new d,e.prototype.update=function(){if(!(this.user&&this.user>0)){var d=c.defer();return d.reject(),d.promise}var e=this;return a({method:"POST",url:"/api/user/"+this.user+"/profile",data:b(e),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return e.setData(a.data),e})},e.prototype.remove=function(){var c=this;return a({method:"DELETE",url:"/api/user/"+this.user+"/profile",data:b(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return c.setData(a.data),c})},e}]),angular.module("pluf").factory("PRole",["PObject","PObjectFactory","$pluf","$injector",function(a,b,c,d){var e=new b(function(a){return this.PGroup||(this.PUser=d.get("PUser")),new this.PUser(a)}),f=new b(function(a){return this.PGroup||(this.PGroup=d.get("PGroup")),new this.PGroup(a)}),g=function(a){a&&this.setData(a)};return g.prototype=new a,g.prototype.update=c.createUpdate({method:"POST",url:"/api/role/:id"}),g.prototype.remove=c.createDelete({method:"DELETE",url:"/api/role/:id"}),g.prototype.removeUser=c.createDeleteAss({method:"DELETE",url:"/api/role/:id/user/{id}"},e),g.prototype.users=c.createFind({method:"GET",url:"/api/role/:id/user/find"},e),g.prototype.newUser=c.createNew({method:"POST",url:"/api/role/:id/user/new"},e),g.prototype.removeGroup=c.createDeleteAss({method:"DELETE",url:"/api/role/:id/group/{id}"}),g.prototype.groups=c.createGet({method:"GET",url:"/api/role/:id/group/find"},f),g.prototype.newGroup=c.createNew({method:"POST",url:"/api/role/:id/group/new"},f),g}]),angular.module("pluf").factory("PUser",["$http","$q","$pluf","PObject","PObjectFactory","$injector",function(a,b,c,d,e,f){var g=new e(function(a){return this.PRole||(this.PProfile=f.get("PProfile")),new this.PProfile(a)}),h=new e(function(a){return this.PRole||(this.PRole=f.get("PRole")),new this.PRole(a)}),i=new e(function(a){return this.PGroup||(this.PGroup=f.get("PGroup")),new this.PGroup(a)}),j=new e(function(a){return this.PMessage||(this.PProfile=f.get("PMessage")),new this.PMessage(a)}),k=function(a){a&&(this.setData(a),this.avatar="/api/user/"+this.id+"/avatar")};return k.prototype=new d,k.prototype.update=c.createUpdate({method:"POST",url:"/api/user/:id"}),k.prototype.newPassword=c.createUpdate({method:"POST",url:"/api/user/:id/password"}),k.prototype.newAvatar=function(b){var c=new FormData;return c.append("file",b),a.post("/api/user/"+this.id+"/avatar",c,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},k.prototype["delete"]=c.createDelete({method:"DELETE",url:"/api/user/:id"}),k.prototype.isAdministrator=function(){return this.id&&this.id>0&&this.administrator},k.prototype.isAnonymous=function(){return!(this.id&&this.id>0)},k.prototype.isStaff=function(){return this.id&&this.id>0&&this.staff},k.prototype.profile=c.createGet({method:"GET",url:"/api/user/:id/profile"},g),k.prototype.removeRole=function(b){return a({method:"DELETE",url:"/api/user/"+this.id+"/role/"+b.id})},k.prototype.roles=c.createFind({method:"GET",url:"/api/user/:id/role/find"},h),k.prototype.newRole=c.createNew({method:"POST",url:"/api/user/:id/role/new"},h),k.prototype.removeGroup=c.createDeleteAss({method:"DELETE",url:"/api/user/:id/group/{id}"}),k.prototype.groups=c.createGet({method:"GET",url:"/api/user/:id/group/find"},i),k.prototype.newGroup=c.createNew({method:"POST",url:"/api/user/:id/group/new"},i),k.prototype.messages=c.createFind({method:"GET",url:"/api/user/:id/message/find"},j),k}]),angular.module("pluf").service("$usr",["$http","$httpParamSerializerJQLike","$q","$act","PUser","PRole","PGroup","PaginatorPage","PException","PObjectCache","PObjectFactory","PUserMessage","$pluf","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a){p=a,n.$emit("$userChange",a)}var p=new e,q=new j(function(a){return new e(a)}),r=new j(function(a){return new f(a)}),s=new j(function(a){return new g(a)}),t=new k(function(a){return new l(a)});this._userCache=q,this._roleCache=r,this._groupCache=s,this.isAnonymous=function(){return p.isAnonymous()},this.isAdministrator=function(){return p.isAdministrator()},
this.session=function(){if(!this.isAnonymous()){var b=c.defer();return b.resolve(p),b.promise}return a.get("/api/user").then(function(a){if(a.data.id){var b=a.data;o(q.restor(b.id,b))}return p})},this.login=function(d){if(!this.isAnonymous()){var e=c.defer();return e.resolve(p),e.promise}return a({method:"POST",url:"/api/user/login",data:b(d),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){var b=a.data;return o(q.restor(b.id,b)),p})},this.logout=function(){if(this.isAnonymous()){var b=c.defer();return b.resolve(p),b.promise}return a({method:"POST",url:"/api/user/logout"}).then(function(){return o(new e({})),p})},this.users=m.createFind({method:"GET",url:"/api/user/find"},q),this.newUser=m.createNew({method:"POST",url:"/api/user/new"},q),this.user=m.createGet({method:"GET",url:"/api/user/{id}"},q),this.roles=m.createFind({method:"GET",url:"/api/role/find"},r),this.role=m.createGet({method:"GET",url:"/api/role/{id}"},r),this.newRole=m.createNew({method:"POST",url:"/api/role/new"},r),this.groups=m.createFind({method:"GET",url:"/api/group/find"},s),this.group=m.createGet({method:"GET",url:"/api/group/{id}"},s),this.newGroup=m.createNew({method:"POST",url:"/api/group/new"},s),this.messages=m.createFind({method:"GET",url:"/api/message/find"},t),this.message=m.createGet({method:"GET",url:"/api/message/{id}"},t)}]);