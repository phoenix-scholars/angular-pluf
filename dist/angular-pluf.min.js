"use strict";angular.module("pluf",[]),angular.module("pluf").factory("PBank",["PObject","$http","$httpParamSerializerJQLike",function(a,b,c){var d=function(){a.apply(this,arguments)};return d.prototype=new a,d.prototype.update=function(){var a=this;return b({method:"POST",url:"/api/bank/engine/"+a.id,data:c(a),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(b){return a.setData(b.data),a})},d.prototype.remove=function(){var a=this;return b({method:"DELETE",url:"/api/bank/engine/"+this.id}).then(function(b){return a.setData(b.data),a})},d}]),angular.module("pluf").factory("PGate",["PObject","$http","$httpParamSerializerJQLike",function(a,b,c){var d=function(){a.apply(this,arguments)};return d.prototype=new a,d.prototype.update=function(){var a=this;return b({method:"POST",url:"/api/bank/backend/"+this.id,data:c(this),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(b){return a.setData(b.data),a})},d.prototype.remove=function(){var a=this;return b({method:"DELETE",url:"/api/bank/backend/"+this.id}).then(function(b){return a.setData(b.data),a.id=null,a})},d}]),angular.module("pluf").factory("PReceipt",["PObject","$http","$httpParamSerializerJQLike",function(a,b,c){var d=function(){a.apply(this,arguments)};return d.prototype=new a,d.prototype.update=function(){var a=this;return b({method:"POST",url:"/api/bank/receipt/"+this.id,data:c(this),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(b){return a.setData(b.data),a})},d.prototype.remove=function(){var a=this;return b({method:"DELETE",url:"/api/bank/receipt/"+this.id}).then(function(b){return a.setData(b.data),a.id=null,a})},d}]),angular.module("pluf").service("$bank",["$http","$q","PaginatorPage","PBank","PGate","PReceipt","$httpParamSerializerJQLike","PObjectCache",function(a,b,c,d,e,f,g,h){function i(a){return angular.isUndefined(a)||!angular.isFunction(a.getParameter)?{}:a.getParameter()}var j=new h(function(a){return new d(a)}),k=new h(function(a){return new d(a)}),l=new h(function(a){return new d(a)});this.createReceipt=function(b){return a({method:"POST",url:"/api/bank/receipt/new",data:g(b),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return l.restor(a.data.id,a.data)})},this.receipt=function(c){if(l.contains(c)){var d=b.defer();return d.resolve(l.get(c)),d.promise}return a.get("/api/bank/receipt/"+c).then(function(a){return l.restor(a.data.id,a.data)})},this.receipts=function(b){return a({method:"GET",url:"/api/bank/receipt/find",params:i(b)}).then(function(a){var b=a.data,d=new c(b);d.items=[];for(var e=0;e<b.counts;e++){var f=b.items[e];d.items.push(l.resotr(f.id,f))}return d})},this.createGate=function(b){return a({method:"POST",url:"/api/bank/backend/new",data:g(b),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return k.restor(a.data.id,a.data)})},this.gate=function(c){if(k.contains(c)){var d=b.defer();return d.resolve(k.get(c)),d.promise}return a({method:"GET",url:"/api/bank/backend/"+c}).then(function(a){return k.restor(a.data.id,a.data)})},this.gates=function(b){return a({method:"GET",url:"/api/bank/backend/find",params:i(b)}).then(function(a){var b=a.data,d=new c(b);d.items=[];for(var e=0;e<b.counts;e++){var f=b.items[e];d.items.push(k.restor(f.id,f))}return d})},this.bank=function(c){if(j.contains(c)){var d=b.defer();return d.resolve(j.get(c)),d.promise}return a({method:"GET",url:"/api/bank/engine/"+c}).then(function(a){return j.restor(a.data.type,a.data)})},this.banks=function(b){return a({method:"GET",url:"/api/bank/engine/find",params:i(b)}).then(function(a){var b=a.data,d=new c(b);d.items=[];for(var e=0;e<b.counts;e++){var f=b.items[e];d.items.push(j.restor(f.type,f))}return d})}}]),angular.module("pluf").factory("PBook",["PObject","PaginatorPage","$http","$httpParamSerializerJQLike","$q","PPage",function(a,b,c,d,e,f){var g=function(){a.apply(this,arguments)};return g.prototype=new a,g.prototype.pages=function(){return c({method:"GET",url:"/api/book/"+this.id+"/page/find"}).then(function(a){for(var c=new b(a.data),d=[],e=0;e<c.counts;e++){var g=c.items[e];d.push(new f(g))}return c.items=d,c})},g.prototype.newPage=function(a){return c({method:"POST",url:"/api/book/"+this.id+"/page/new",data:d(a)}).then(function(a){return new f(a.data)})},g.prototype.page=function(a){return c({method:"GET",url:"/api/book/"+this.id+"/page/"+a}).then(function(a){return new f(a.data)})},g.prototype.update=function(){var a=this;return c({method:"POST",url:"/api/book/"+a.id,data:d(this),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(b){return a.setData(b.data),a})},g.prototype.remove=function(){var a=this;return c({method:"DELETE",url:"/api/book/"+a.id}).then(function(b){return a.setData(b.data),a})},g}]),angular.module("pluf").factory("PPage",["$http","$httpParamSerializerJQLike","PObject",function(a,b,c){var d=function(a){a&&this.setData(a)};return d.prototype=new c,d.prototype.update=function(){var c=this;return a({method:"POST",url:"/api/book/"+this.book+"/page/"+this.id,data:b(this),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return c.setData(a.data),c})},d.prototype.remove=function(){var b=this;return a({method:"DELETE",url:"/api/book/"+this.book+"/page/"+this.id}).then(function(a){return b.setData(a.data),b})},d.prototype.toHTML=function(){return markdown.toHTML(this.content)},d}]),angular.module("pluf").service("$book",["$http","$httpParamSerializerJQLike","$q","PBook","PaginatorPage","PObjectCache",function(a,b,c,d,e,f){var g="application/x-www-form-urlencoded",h=new f(function(a){return new d(a)});this._cache=h,this.books=function(b){var c={};return b&&(c=b.getParameter()),a({method:"GET",url:"/api/book/find",params:b}).then(function(a){for(var b=new e(a.data),c=[],d=0;d<b.counts;d++){var f=b.items[d];f=h.restor(f.id,f),c.push(f)}return b.items=c,b})},this.book=function(b){if(h.contains(b)){var d=c.defer();return d.resolve(h.get(b)),d.promise}return a({method:"GET",url:"/api/book/"+b}).then(function(a){return h.restor(a.data.id,a.data)})},this.newBook=function(c){return a({method:"POST",url:"/api/book/new",data:b(c),headers:{"Content-Type":g}}).then(function(a){return h.restor(a.data.id,a.data)})}}]),angular.module("pluf").filter("unsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),angular.module("pluf").factory("PContent",["$http","$httpParamSerializerJQLike","$q","PObject",function(a,b,c,d){function e(a){a.link="/api/cms/"+a.id+"/download"}var f=function(){d.apply(this,arguments),e(this)};return f.prototype=new d,f.prototype.update=function(){var c=this;return a({method:"POST",url:"/api/cms/"+this.id,data:b(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return c.setData(a.data),e(c),c})},f.prototype.remove=function(){var b=this;return a({method:"DELETE",url:"/api/cms/"+this.id}).then(function(){return delete b.id,b})},f.prototype.value=function(){return a({method:"GET",url:this.link}).then(function(a){return a.data})},f.prototype.setValue=function(b){var c=this;return a({method:"POST",url:this.link,data:b}).then(function(){return c})},f.prototype.upload=function(b){var c=new FormData;return c.append("file",b),a.post(this.link,c,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},f}]),angular.module("pluf").service("$cms",["$http","$httpParamSerializerJQLike","$q","$timeout","PContent","PaginatorPage","PObjectCache","$pluf",function(a,b,c,d,e,f,g,h){var i=new g(function(a){return new e(a)});this._cache=i,this.newContent=h.createNew({method:"POST",url:"/api/cms/new"},i),this.content=h.createGet({method:"GET",url:"/api/cms/{id}"},i),this.contents=h.createFind({method:"GET",url:"/api/cms/find"},i)}]),angular.module("pluf").factory("PCommand",function(){var a=function(a){this.priority=0,this.tags=[],a&&this.setData(a),this.handlers=[],"visible"in a||(this.visible=function(){return!0}),"enable"in a||(this.enable=function(){return!0})};return a.prototype.setData=function(a){return angular.extend(this,a),this},a.prototype.handler=function(a){return this.handlers.push(a),this},a.prototype.tag=function(a){this.tags.push(a)},a}),angular.module("pluf").factory("PException",["PObject",function(a){var b=function(){a.apply(this,arguments)};return b.prototype=new a,b}]),angular.module("pluf").factory("PHandler",function(){var a=function(a){this.priority=0,a&&this.setData(a)};return a.prototype.setData=function(a){return angular.extend(this,a),this},a}),angular.module("pluf").factory("PMenu",function(){var a=function(a){this.priority=0,this.tags=[],a&&this.setData(a),this.items=[]};return a.prototype.setData=function(a){return angular.extend(this,a),this},a.prototype.item=function(a){return this.items.push(a),this},a.prototype.tag=function(a){this.tags.push(a)},a}),angular.module("pluf").factory("PMenuItem",["$window","$act",function(a,b){var c=function(a){this.priority=0,this.tags=[],a&&this.setData(a)};return c.prototype.setData=function(a){if("command"in a){var c=this;b.getCommand(a.command).then(function(b){angular.extend(c,b),angular.extend(c,a)})}else angular.extend(this,a);return this},c.prototype.tag=function(a){this.tags.push(a)},c.prototype.active=function(){if("command"in this){var c=[this.command];return this.params instanceof Array&&(c=c.concat(this.params)),b.execute.apply(b,c)}if("action"in this)return this.action();if("link"in this)return void(a.location=this.link);throw{status:404,code:523,message:"Menu item is not supported"}},c}]),angular.module("pluf").factory("PMessage",function(){var a=function(a){a&&this.setData(a)};return a.prototype.setData=function(a){return angular.extend(this,a),this},a.prototype.isInfo=function(){return"info"===this.type},a.prototype.isDebug=function(){return"debug"===this.type},a.prototype.isWarning=function(){return"warning"===this.type},a.prototype.isError=function(){return"error"===this.type},a}),angular.module("pluf").factory("PObject",function(){var a=function(a){a&&this.setData(a)};return a.prototype={setData:function(a){angular.extend(this,a)},isAnonymous:function(){return!(this.id&&this.id>0)},isExpired:function(){return!1}},a}),angular.module("pluf").factory("PObjectCache",function(){var a=function(a){this._cache=[],this.factory=a};return a.prototype.get=function(a){return this._cache[a]?this._cache[a].isAnonymous()||this._cache[a].isExpired()?(delete this._cache[a],null):this._cache[a]:null},a.prototype.getObject=a.prototype.get,a.prototype.restor=function(a,b){var c=this.getObject(a);return c?c.setData(b):(c=this.factory(b),this._cache[a]=c),c},a.prototype.contains=function(a){return a in this._cache},a}),angular.module("pluf").factory("PObjectFactory",function(){var a=function(a){this.factory=a};return a.prototype.get=function(){return null},a.prototype.restor=function(a,b){b.id=a;var c=this.factory(b);return c},a.prototype.contains=function(){return!1},a}),angular.module("pluf").factory("PaginatorPage",["PObject",function(a){var b=function(){a.apply(this,arguments)};return b.prototype=new a,b.prototype.hasMore=function(){return this.current_page<this.page_number},b.prototype.isFirst=function(){return 1===this.current_page},b.prototype.next=function(){return this.current_page+1},b.prototype.previous=function(){return this.current_page-1},b}]),angular.module("pluf").factory("PaginatorParameter",function(){var a=function(){this.param={}};return a.prototype={setSize:function(a){return this.param._px_c=a,this},setQuery:function(a){return this.param._px_q=a,this},setPage:function(a){return this.param._px_p=a,this},nextPage:function(){return this.param._px_p+=1,this},setOrder:function(a,b){return this.param._px_sk=a,this.param._px_so=b,this},setFilter:function(a,b){return this.param._px_fk=a,this.param._px_fv=b,this},getParameter:function(){return this.param},put:function(a,b){return this.param[a]=b,this},get:function(a){return this.param[a]}},a}),angular.module("pluf").factory("PPreferenceNode",["PObject","$q","$timeout",function(a,b,c){var d=function(){a.apply(this,arguments)};return d.prototype=new a,d.prototype.newNode=function(a){var d=b.defer();return c(function(){d.reject(a)},1),d.promise},d.prototype.node=function(){},d.prototype.nodes=function(){},d.prototype.parent=function(){},d}]),angular.module("pluf").factory("PPreferenceProperty",["PPreferenceNode",function(a){var b=function(){a.apply(this,arguments)};return b.prototype=new a,b.prototype.setValue=function(){},b.prototype.value=function(){},b}]),angular.module("pluf").factory("PProcess",["PObject",function(a){var b=function(){a.apply(this,arguments),this.progress||(this.progress={})};return b.prototype.OK=0,b.prototype.INFO=1,b.prototype.WARNING=2,b.prototype.ERROR=4,b.prototype.CANCEL=8,b.prototype.setWorked=function(a){return this.progress.worked=a,this},b.prototype.worked=function(){return this.progress.worked},b.prototype.addWorked=function(a){return this.progress.worked?this.progress.worked+=a:this.progress.worked=a,this},b.prototype.setTotalWork=function(a){return this.progress.totalWorked=a,this},b.prototype.totalWork=function(){return this.progress.totalWorked},b.prototype.percentage=function(){return this.progress.totalWorked<=0?0:100*this.progress.worked/this.progress.worked},b.prototype.setTaskName=function(a){return this.progress.taskName=a,this},b.prototype.taskName=function(){return this.progress.taskName},b.prototype.setSubTask=function(a){return this.progress.subTask=a,this},b.prototype.subTask=function(){return this.progress.subTask},b}]),angular.module("pluf").service("$act",["$q","$timeout","PCommand","PHandler",function(a,b,c,d){this._commands=[],this.getCommand=function(c){var d=a.defer(),e=this;return b(function(){return c in e._commands?void d.resolve(e._commands[c]):void d.reject({status:404,code:10,message:"command not found"})},1),d.promise},this.command=function(a){if(!a.id)throw{status:404,code:11,message:"Command id is empty"};var b;return a.id in this._commands?(b=this._commands[a.id],b.setData(a)):(b=new c(a),this._commands[b.id]=b),this},this.handler=function(a){var b;return a.command in this._commands?b=this._commands[a.command]:(b=new c({id:a.command}),this._commands[b.id]=b),b.handler(new d(a)),this},this.execute=function(c){var d=a.defer();if(c in this._commands){var e=this,f=Array.prototype.slice.call(arguments).slice(1);return b(function(){var a=e._commands[c];a.handlers.forEach(function(a){a.handle.apply(a,f)}),d.resolve()},1),d.promise}return d.reject({message:"Command not found :"+c,statuse:400,code:4404}),d.promise}}]),angular.module("pluf").service("$menu",["$q","$timeout","PMenu","PMenuItem",function(a,b,c,d){this.menus=[],this._addMenu=function(a,b){a in this.menus||(this.menus[a]=new c({id:a})),this.menus[a].item(b)},this.menu=function(d){var e=a.defer(),f=this;return b(function(){d in f.menus||(f.menus[d]=new c({id:d})),e.resolve(f.menus[d])},1),e.promise},this.addItem=function(a,b){return this._addMenu(a,new d(b)),this}}]),angular.module("pluf").service("$notify",["$rootScope","$timeout","$q","PMessage",function(a,b,c,d){this._listeners=[],this._fire=function(a,e){var f=c.defer(),g=[];return g.push(new d(e)),b(function(){for(var b=0;b<a.length;b++)a[b].apply(a[b],g);f.resolve()},10),f.promise},this.onMessage=function(a){return this._listeners.push(a),this},this.info=function(a){return a.type="info",this._fire(this._listeners,a)},this.warning=function(a){return a.type="warning",this._fire(this._listeners,a)},this.debug=function(a){return a.type="debug",this._fire(this._listeners,a)},this.error=function(a){return a.type="error",this._fire(this._listeners,a)}}]),angular.module("pluf").service("$pluf",["PaginatorPage","$q","$http","$httpParamSerializerJQLike",function(a,b,c,d){function e(a,b){if(0===a.indexOf(":"))return a;for(var c=a.split("/"),d=a,e=0;e<c.length;e++){var f=c[e];if(0===f.indexOf(":")){var g=f.substring(1,f.length);d=d.replace(f,b[g])}}return d}this.createFind=function(b,d){var f=b.url;return function(g){return g&&(b.params=g.getParameter()),b.url=e(f,this),c(b).then(function(b){for(var c=new a(b.data),e=[],f=0;f<c.counts;f++){var g=c.items[f];e.push(d.restor(g.id,g))}return c.items=e,c})}},this.createGet=function(a,d){var f=a.url;return function(g){if(d.contains(g)){var h=b.defer();return h.resolve(d.get(g)),h.promise}var i=e(f,this);return a.url=i.replace("{id}",g),c(a).then(function(a){return d.restor(a.data.id,a.data)})}},this.createUpdate=function(a){a.headers={"Content-Type":"application/x-www-form-urlencoded"};var b=a.url;return function(f){f||(f=this);var g=this;return a.url=e(b,g),a.data=d(f),c(a).then(function(a){return g.setData(a.data),g})}},this.createDelete=function(a){var b=a.url;return function(){var d=this;return a.url=e(b,d),c(a).then(function(a){return d.setData(a.data),d})}},this.createNew=function(a,b){a.headers={"Content-Type":"application/x-www-form-urlencoded"};var f=a.url;return function(g){return a.url=e(f,this),a.data=d(g),c(a).then(function(a){return b.restor(a.data.id,a.data)})}}}]),angular.module("pluf").service("$preference",function(){this.newNode=function(){},this.node=function(){},this.nodes=function(){}}),angular.module("pluf").service("$process",function(){this.processes=function(){},this.process=function(){}}),angular.module("pluf").factory("PMonitor",["PObject","$rootScope","$http","PObjectFactory",function(a,b,c,d){var e=function(a){a&&(this.setData(a),this.path="/api/monitor/"+this.bean+"/"+this.property)};return e.prototype=new a,e.prototype.refresh=function(){var a=this;return c.get(this.path).then(function(c){return c.data.value!==a.value&&b.$emit(a.path,a.value,c.data.value),a.setData(c.data),a})},e.prototype.setBean=function(a){return this.bean=a,this.path="/api/monitor/"+this.bean+"/"+this.property,this},e.prototype.setProperty=function(a){return this.property=a,this.path="/api/monitor/"+this.bean+"/"+this.property,this},e.prototype.watch=function(a){return b.$on(this.path,a)},e}]),angular.module("pluf").service("$monitor",["$q","$timeout","$pluf","PMonitor","PObjectFactory",function(a,b,c,d,e){function f(){if(0==g.length)return void b(f,h);for(var c=[],d=0;d<g.length;d++){var e=g[d];c.push(e.refresh())}return a.all(c)["finally"](function(){b(f,h)})}var g=[],h=6e4,i=new e(function(a){return new this.PMonitor(a)});this.monitor=function(c,e){var f=a.defer();return b(function(){var a=null;return angular.forEach(g,function(b){b.bean===c&&b.property==e&&(a=b)}),a?void f.resolve(a):(a=new d,a.setBean(c).setProperty(e),g.push(a),void f.resolve(a))},1),f.promise},this.monitors=c.createFind({method:"GET",url:"/api/monitor/find"},i),this.distroy=function(c){var d=a.defer();return b(function(){d.resolve(c)},1),d.promise},f()}]),angular.module("pluf").run(["$act",function(a){a.command({id:"tenant.lunch",category:"saas"}).command({id:"spa.lunch",category:"saas"})}]),angular.module("pluf").run(["$window","$act","$saas","PException",function(a,b,c,d){b.handler({command:"tenant.lunch",handle:function(){if(arguments.length<1)throw new d("tenant not found");var a=arguments[0];return c.get(a).then(function(a){return a.defaultApplication()}).then(function(a){return a.run()})}}).handler({command:"spa.lunch",handle:function(){if(arguments.length<1)throw new d("application not found");var a=arguments[0];return c.session().then(function(b){return b.app(a)}).then(function(a){return a.run()})}})}]),angular.module("pluf").factory("PSpa",["$http","$q","$window","PSpaDetail","PObject",function(a,b,c,d,e){var f=function(){e.apply(this,arguments)};return f.prototype=new e,f.prototype.setTenant=function(a){return this._tenant=a,this},f.prototype.reload=function(){},f.prototype.update=function(){},f.prototype["delete"]=function(){},f.prototype.detail=function(){if(this._detail){var c=b.defer();return c.resolve(this._detail),c.promise}var e=this;return a({method:"GET",url:"/api/saas/spa/"+this.id+"/detail"}).then(function(a){return e._detail=new d(a.data),e._detail})},f.prototype.run=function(){c.location=c.location.origin+"/"+this._tenant.id+"/"+this.id},f}]),angular.module("pluf").factory("PSpaDetail",["$http","$q","$window","PObject",function(a,b,c,d){var e=function(){d.apply(this,arguments)};return e.prototype=new d,e}]),angular.module("pluf").factory("PTenant",["$http","$httpParamSerializerJQLike","$window","$q","PObject","PException","PProfile","PaginatorParameter","PaginatorPage","PSpa",function(a,b,c,d,e,f,g,h,i,j){var k=function(){e.apply(this,arguments)};return k.prototype=new e,k.prototype._spa=[],k.prototype._retSpa=function(a){var b;return a.id in this._spa?(b=this._spa[a.id],b.setData(a),b):(b=new j(a).setTenant(this),this._spa[b.id]=b,b)},k.prototype["delete"]=function(){},k.prototype.update=function(){var c=this;return a({method:"POST",url:"/api/saas/"+this.id,data:b(this),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return c.setData(a.data),c})},k.prototype.setting=function(){},k.prototype.config=function(){},k.prototype.members=function(){if(this.isAnonymous()||this.memberLoaded()){var b=d.defer();return this.isAnonymous()?b.reject("authentication requried"):b.resolve(this._member),b.promise}var c=this;return a({method:"GET",url:"/api/saas/app/"+this.id+"/member/list"}).then(function(a){return c.$member.setData(a.data),c.$member},function(a){throw new f(a)})},k.prototype.groups=function(){},k.prototype.group=function(){},k.prototype.accesses=function(){},k.prototype.access=function(){},k.prototype.newAccess=function(){},k.prototype.spas=function(b){b||(b=new h);var c=this;return a({method:"GET",url:"/api/"+this.id+"/saas/spa/find",params:b.getParameter()}).then(function(a){for(var b=new i(a.data),d=[],e=0;e<b.counts;e++){var f=c.ret(b.items[e]);d.push(f)}return b.items=d,b},function(a){throw new f(a)})},k.prototype.spa=function(b){var c=this;return a({method:"GET",url:"/api/saas/spa/"+b}).then(function(a){return c._regSpa(a.data)})},k.prototype.newSpa=function(){},k.prototype["goto"]=function(){c.location=c.location.origin+"/"+this.id},k}]),angular.module("pluf").factory("PTenantGroup",["$http","$q","$window","PObject",function(a,b,c,d){var e=function(){d.apply(this,arguments)};return e.prototype=new d,e}]),angular.module("pluf").factory("PTenantSetting",["$http","$q","$window","PObject",function(a,b,c,d){var e=function(){d.apply(this,arguments)};return e.prototype=new d,e}]),angular.module("pluf").factory("PSpa",["$http","$httpParamSerializerJQLike","$q","$window","PObject",function(a,b,c,d,e){var f=function(){e.apply(this,arguments)};return f.prototype=new e,f.prototype.setTenant=function(a){return this._tenant=a,this},f.prototype.reload=function(){},f.prototype.update=function(){var c=this;return a({method:"POST",url:"/api/spa/"+this.id,data:b(this),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return c.setData(a.data),c})},f.prototype.remove=function(){var b=this;return a({method:"DELETE",url:"/api/spa/"+this.id}).then(function(a){return b.setData(a.data),b})},f}]),angular.module("pluf").factory("PTenant",["$http","$httpParamSerializerJQLike","$window","$q","PObject",function(a,b,c,d,e){var f=function(){e.apply(this,arguments)};return f.prototype=new e,f.prototype.remove=function(){var b=this;return a({method:"DELETE",url:"/api/tenant/"+this.id}).then(function(a){return b.setData(a.data),b})},f.prototype.update=function(){var c=this;return a({method:"POST",url:"/api/tenant/"+this.id,data:b(this),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return c.setData(a.data),c})},f}]),angular.module("pluf").service("$saas",["$http","PTenant","PSpa","PObjectCache","$pluf",function(a,b,c,d,e){var f=new d(function(a){return new b(a)}),g=new d(function(a){return new c(a)});this.session=function(){return a.get("/api/tenant").then(function(a){return f.restor(a.data)})},this.tenants=e.createFind({method:"GET",url:"/api/tenant/find"},f),this.tenant=e.createGet({url:"/api/tenant/{id}",method:"GET"},f),this.newTenant=e.createNew({method:"POST",url:"/api/tenant/new"},f),this.spas=e.createFind({method:"GET",url:"/api/spa/find"},g),this.spa=e.createGet({url:"/api/spa/{id}",method:"GET"},g),this.newSpa=function(b){var d=new FormData;return d.append("file",b),a.post("/api/spa/new",d,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(a){return new c(a.data)})}}]),angular.module("pluf").factory("PFollower",["PObject",function(a){var b=function(){a.apply(this,arguments)};return b.prototype=new a,b}]),angular.module("pluf").service("$news",["$httpParamSerializerJQLike","$http","$q","PException","PFollower","PaginatorPage",function(a,b,c,d,e,f){this._df=[],this._getf=function(a){return this._df[a]},this._retf=function(a,b){var c=this._getf(a);return c?(c.setData(b),c):(this._df[a]=new e(b),this._df[a])},this.validateFollower=function(a){var b=c.defer(),d=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(d.test(a))return b.resolve({type:"email",address:a}),b.promise;var e=/^\+?\d{10,14}$/;return e.test(a)?(b.resolve({type:"mobile",address:a}),b.promise):(b.resolve({type:"other",address:a}),b.promise)},this.newFollower=function(c){var d=this;return b({method:"POST",url:"/api/newspaper/follower/new",data:a(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return d._retf(a.data.id,a.data)})},this.followers=function(a){var c=this;return b({method:"GET",url:"/api/newspaper/follower/find",params:a.getParameter()}).then(function(a){var b=new f(a.data);b.items=[];for(var d=0;d<a.data.counts;d++)b.items.push(c._retf(a.data.items[d].id,a.data.items[d]));return b})},this.follower=function(){}}]),angular.module("pluf").run(["$usr","$act",function(a,b){b.command({id:"user.logout",label:"logout",description:"logout the user",visible:function(){return!a.isAnonymous()},category:"usr"})}]),angular.module("pluf").run(["$usr","$act",function(a,b){b.handler({commandId:"user.logout",handle:function(){return a.logout()}})}]),angular.module("pluf").factory("PGroup",["PObject","$http","$httpParamSerializerJQLike","$q","$injector","PaginatorPage",function(a,b,c,d,e,f){var g=function(a){a&&this.setData(a)};return g.prototype=new a,g.prototype.update=function(){if(this.isAnonymous()){var a=d.defer();return a.reject(),a.promise}var e=this;return b({method:"POST",url:"/api/group/"+this.id,data:c(e),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return e.setData(a.data),e})},g.prototype.remove=function(){var a=this;return b({method:"DELETE",url:"/api/group/"+this.id}).then(function(b){return a.setData(b.data),a})},g.prototype.removeRole=function(a){return b({method:"DELETE",url:"/api/group/"+this.id+"/role/"+a.id})},g.prototype.roles=function(a){var c={};return a&&(c=a.getParameter()),b({method:"GET",url:"/api/group/"+this.id+"/role/find",params:c}).then(function(a){for(var b=e.get("$usr"),c=new f(a.data),d=[],g=0;g<c.counts;g++){var h=c.items[g];d.push(b._roleCache.restor(h.id,h))}return c.items=d,c})},g.prototype.removeUser=function(a){return b({method:"DELETE",url:"/api/group/"+this.id+"/user/"+a.id})},g.prototype.users=function(a){var c={};return a&&(c=a.getParameter()),b({method:"GET",url:"/api/group/"+this.id+"/user/find",params:c}).then(function(a){for(var b=e.get("$usr"),c=new f(a.data),d=[],g=0;g<c.counts;g++){var h=c.items[g];d.push(b._userCache.restor(h.id,h))}return c.items=d,c})},g}]),angular.module("pluf").factory("PUserMessage",["$pluf","PObject",function(a,b){var c=function(a){a&&this.setData(a)};return c.prototype=new b,c.prototype["delete"]=a.createDelete({method:"DELETE",url:"/api/message/:id"}),c}]),angular.module("pluf").factory("PProfile",["$http","$httpParamSerializerJQLike","$q","PObject",function(a,b,c,d){var e=function(a){a&&this.setData(a)};return e.prototype=new d,e.prototype.update=function(){if(this.user.isAnonymous()){var d=c.defer();return d.reject(),d.promise}var e=this;return a({method:"POST",url:"/api/user/"+this.user.id+"/profile",data:b(e),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return e.setData(a.data),e})},e.prototype.remove=function(){var c=this;return a({method:"DELETE",url:"/api/user/"+this.user+"/profile",data:b(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return c.setData(a.data),c})},e}]),angular.module("pluf").factory("PRole",["PObject","$http","$httpParamSerializerJQLike","$q","$injector","PaginatorPage",function(a,b,c,d,e,f){var g=function(a){a&&this.setData(a)};return g.prototype=new a,g.prototype.update=function(){if(this.isAnonymous()){var a=d.defer();return a.reject(),a.promise}var e=this;return b({method:"POST",url:"/api/role/"+this.id,data:c(this),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return e.setData(a.data),e})},g.prototype.remove=function(){var a=this;return b({method:"DELETE",url:"/api/role/"+this.id,data:c(a),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(b){return a.setData(b.data),a})},g.prototype.removeUser=function(a){return b({method:"DELETE",url:"/api/role/"+this.id+"/user/"+a.id})},g.prototype.users=function(a){var c={};return a&&(c=a.getParameter()),b({method:"GET",url:"/api/role/"+this.id+"/user/find",params:c}).then(function(a){for(var b=e.get("$usr"),c=new f(a.data),d=[],g=0;g<c.counts;g++){var h=c.items[g];d.push(b._userCache.restor(h.id,h))}return c.items=d,c})},g.prototype.removeGroup=function(a){return b({method:"DELETE",url:"/api/role/"+this.id+"/group/"+a.id})},g.prototype.groups=function(a){var c={};return a&&(c=a.getParameter()),b({method:"GET",url:"/api/role/"+this.id+"/group/find",params:c}).then(function(a){for(var b=e.get("$usr"),c=new f(a.data),d=[],g=0;g<c.counts;g++){var h=c.items[g];d.push(b._groupCache.restor(h.id,h))}return c.items=d,c})},g}]),angular.module("pluf").factory("PUser",["$http","$q","$pluf","PObject","PObjectFactory","$injector",function(a,b,c,d,e,f){var g=new e(function(a){return this.PRole||(this.PProfile=f.get("PProfile")),new this.PProfile(a)}),h=new e(function(a){return this.PRole||(this.PRole=f.get("PRole")),new this.PRole(a)}),i=new e(function(a){return this.PGroup||(this.PGroup=f.get("PGroup")),new this.PGroup(a)}),j=new e(function(a){return this.PMessage||(this.PProfile=f.get("PMessage")),new this.PMessage(a)}),k=function(a){a&&(this.setData(a),this.avatar="/api/user/"+this.id+"/avatar")};return k.prototype=new d,k.prototype.update=c.createUpdate({method:"POST",url:"/api/user/:id"}),k.prototype.remove=c.createDelete({method:"DELETE",url:"/api/user/:id"}),k.prototype.isAdministrator=function(){return this.id&&this.id>0&&this.administrator},k.prototype.isStaff=function(){return this.id&&this.id>0&&this.staff},k.prototype.profile=c.createGet({method:"GET",url:"/api/user/:id/profile"},g),k.prototype.removeRole=function(b){return a({method:"DELETE",url:"/api/user/"+this.id+"/role/"+b.id})},k.prototype.roles=c.createFind({method:"GET",url:"/api/user/:id/role/find"},h),k.prototype.newRole=c.createNew({method:"POST",url:"/api/user/:id/role/new"},h),k.prototype.removeGroup=function(b){return a({method:"DELETE",url:"/api/user/"+this.id+"/group/"+b.id})},k.prototype.groups=c.createGet({method:"GET",url:"/api/user/:id/group/find"},i),k.prototype.newGroup=c.createNew({method:"POST",url:"/api/user/:id/group/new"},h),k.prototype.messages=c.createFind({method:"GET",url:"/api/user/:id/message/find"},j),k}]),angular.module("pluf").service("$usr",["$http","$httpParamSerializerJQLike","$q","$act","PUser","PRole","PGroup","PaginatorPage","PException","PObjectCache","PObjectFactory","PUserMessage","$pluf","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a){p=a,n.$emit("$userChange",a)}var p=new e,q=new j(function(a){return new e(a)}),r=new j(function(a){return new f(a)}),s=new j(function(a){return new g(a)}),t=new k(function(a){return new l(a)});this._userCache=q,
this._roleCache=r,this._groupCache=s,this.isAnonymous=function(){return p.isAnonymous()},this.isAdministrator=function(){return p.isAdministrator()},this.session=function(){if(!this.isAnonymous()){var b=c.defer();return b.resolve(p),b.promise}return a.get("/api/user").then(function(a){if(a.data.id){var b=a.data;o(q.restor(b.id,b))}return p})},this.login=function(d){if(!this.isAnonymous()){var e=c.defer();return e.resolve(p),e.promise}return a({method:"POST",url:"/api/user/login",data:b(d),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){var b=a.data;return o(q.restor(b.id,b)),p})},this.logout=function(){if(this.isAnonymous()){var b=c.defer();return b.resolve(p),b.promise}return a({method:"POST",url:"/api/user/logout"}).then(function(){return o(new e({})),p})},this.users=m.createFind({method:"GET",url:"/api/user/find"},q),this.newUser=m.createNew({method:"POST",url:"/api/user/new"},q),this.user=m.createGet({method:"GET",url:"/api/user/{id}"},q),this.roles=m.createFind({method:"GET",url:"/api/role/find"},r),this.role=m.createGet({method:"GET",url:"/api/role/{id}"},r),this.newRole=m.createNew({method:"POST",url:"/api/role/new"},r),this.groups=m.createFind({method:"GET",url:"/api/group/find"},s),this.group=m.createGet({method:"GET",url:"/api/group/{id}"},s),this.newGroup=m.createNew({method:"POST",url:"/api/group/new"},s),this.messages=m.createFind({method:"GET",url:"/api/message/find"},t),this.message=m.createGet({method:"GET",url:"/api/message/{id}"},t)}]);