/*! angular-pluf 2016-06-02 */
!function(){angular.module("pluf",[]).run(function($usr,$act){$act.command({id:"pluf.user.login",label:"login",description:"login a user",visible:function(){return $usr.isAnonymous()},category:"usr"}).handler({commandId:"pluf.user.login",handle:function(){if(arguments.length<1)throw new PException("no credentioal");var a=arguments[0];return $usr.login(a.username,a.password)}}).command({id:"pluf.user.logout",label:"logout",description:"logout the user",visible:function(){return!$usr.isAnonymous()},category:"usr"}).handler({commandId:"pluf.user.logout",handle:function(){return $usr.logout()}}).command({id:"pluf.user.update",label:"update",description:"update the current user",visible:function(){return!$usr.isAnonymous()}}).handler({commandId:"pluf.user.update",handle:function(){if(arguments.length<1)throw new PException("bad param");var a=arguments[0];return $usr.session().then(function(user){return user.update(a.key,a.value)})}}).command({id:"pluf.user.profile.update",label:"update profile",description:"update user profile",visible:function(){return!$usr.isAnonymous()}}).handler({commandId:"pluf.user.profile.update",handle:function(){if(arguments.length<1)throw new PException("bad param");var a=arguments[0];return $usr.session().then(function(user){return user.profile()}).then(function(profile){return profile.update(a.key,a.value)})}})})}(),function(){"use strict";angular.module("pluf.saas",["pluf"]).run(function($window,$act,$tenant){$act.command({id:"pluf.saas.lunch",category:"saas"}).commandHandler({commandId:"pluf.saas.lunch",handle:function(){if(arguments.length<1)throw new PException("no app found");var a=arguments[0];return $tenant.get(a).then(function(tenant){return tenant.defaultApplication()}).then(function(app){return app.run()})}}).command({id:"pluf.saas.app.lunch",category:"saas"}).commandHandler({commandId:"pluf.saas.app.lunch",handle:function(){if(arguments.length<1)throw new PException("no app found");var a=arguments[0];return $tenant.session().then(function(tenant){return tenant.app(a)}).then(function(app){return app.run()})}})})}(),function(){"use strict";angular.module("pluf.social",["pluf"])}(),function(){"use strict";angular.module("pluf.wiki",["pluf"])}(),function(angular){function PCommand(){var pCommand=function(data){this.priority=0,this.tags=[],data&&this.setData(data),this.handlers=[],"visible"in data||(this.visible=function(){return!0}),"enable"in data||(this.enable=function(){return!0})};return pCommand.prototype.setData=function(data){return angular.extend(this,data),this},pCommand.prototype.handler=function(h){return this.handlers.push(h),this},pCommand.prototype.tag=function(tag){this.tags.push(tag)},pCommand}angular.module("pluf").factory("PCommand",[PCommand])}(window.angular),function(){function PContent($http,$httpParamSerializerJQLike,$q,PObject,PException){var pContent=function(){PObject.apply(this,arguments)};return pContent.prototype=new PObject,pContent.prototype.update=function(){},pContent.prototype.remove=function(){},pContent.prototype.value=function(){return $http({method:"GET",url:"/api/saascms/content/"+this.id+"/download"}).then(function(res){return res.data})},pContent.prototype.setValue=function(d){var scope=this;return $http({method:"POST",url:"/api/saascms/content/"+this.id+"/download",data:d}).then(function(res){return scope})},pContent}angular.module("pluf").factory("PContent",["$http","$httpParamSerializerJQLike","$q","PObject","PException",PContent])}(),function(){function PException(PObject){var pException=function(){PObject.apply(this,arguments)};return pException.prototype=new PObject,pException}angular.module("pluf").factory("PException",["PObject",PException])}(),function(angular){function PHandler(){var pHandler=function(data){this.priority=0,data&&this.setData(data)};return pHandler.prototype.setData=function(data){return angular.extend(this,data),this},pHandler}angular.module("pluf").factory("PHandler",[PHandler])}(window.angular),function(angular){function PMenu(){var pMenu=function(data){this.priority=0,this.tags=[],data&&this.setData(data),this.items=[]};return pMenu.prototype.setData=function(data){return angular.extend(this,data),this},pMenu.prototype.item=function(h){return this.items.push(h),this},pMenu.prototype.tag=function(tag){this.tags.push(tag)},pMenu}angular.module("pluf").factory("PMenu",["PMenuItem",PMenu])}(window.angular),function(angular){function PMenuItem($window,$act){var pMenuItem=function(data){this.priority=0,this.tags=[],data&&this.setData(data)};return pMenuItem.prototype.setData=function(data){if("command"in data){var scope=this;$act.getCommand(data.command).then(function(command){angular.extend(scope,command),angular.extend(scope,data)})}else angular.extend(this,data);return this},pMenuItem.prototype.tag=function(tag){this.tags.push(tag)},pMenuItem.prototype.active=function(){if("command"in this){var args=[menu.command];return this.params instanceof Array&&(args=args.concat(this.params)),$act.execute.apply($act,args)}if("action"in this)return this.action();if("link"in this)return void($window.location=this.link);throw{status:404,code:523,message:"Menu item is not supported"}},pMenuItem}angular.module("pluf").factory("PMenuItem",["$window","$act",PMenuItem])}(window.angular),function(angular){function PMessage(){var pMessage=function(data){data&&this.setData(data)};return pMessage.prototype.setData=function(data){return angular.extend(this,data),this},pMessage.prototype.isInfo=function(){return"info"==this.type},pMessage.prototype.isDebug=function(){return"debug"==this.type},pMessage.prototype.isWarning=function(){return"warning"==this.type},pMessage.prototype.isError=function(){return"error"==this.type},pMessage}angular.module("pluf").factory("PMessage",[PMessage])}(window.angular),function(){function PNamedContent($http,$httpParamSerializerJQLike,$q,PObject,PException,PContent){var pNamedContent=function(){PObject.apply(this,arguments)};return pNamedContent.prototype=new PObject,pNamedContent.prototype.update=function(){},pNamedContent.prototype.remove=function(){},pNamedContent.prototype.value=function(){return this.content.value()},pNamedContent.prototype.setValue=function(v){return this.content.setValue(v)},pNamedContent}angular.module("pluf").factory("PNamedContent",["$http","$httpParamSerializerJQLike","$q","PObject","PException","PContent",PNamedContent])}(),function(){function PObject(){var pObject=function(data){data&&this.setData(data)};return pObject.prototype={setData:function(data){angular.extend(this,data)},isAnonymous:function(){return!(this.id&&this.id>0)}},pObject}angular.module("pluf").factory("PObject",[PObject])}(),function(){function PaginatorPage(PObject){var paginatorPage=function(){PObject.apply(this,arguments)};return paginatorPage.prototype=new PObject,paginatorPage}angular.module("pluf").factory("PaginatorPage",["PObject",PaginatorPage])}(),function(){function PaginatorParameter(){var pagParam=function(paginatorParam){paginatorParam?this.setData(paginatorParam):this.setData({})};return pagParam.prototype={param:{},setData:function(paginatorParam){this.param=paginatorParam},setSize:function($size){return this.param._px_c=$size,this},setQuery:function($query){return this.param._px_q=$query,this},setPage:function($page){return this.param._px_p=$page,this},setOrder:function($key,$order){return this.param._px_sk=$key,this.param._px_so=$order,this},setFilter:function($key,$value){return this.param._px_fk=$key,this.param._px_fv=$value,this},getParameter:function(){return this.param}},pagParam}angular.module("pluf").factory("PaginatorParameter",[PaginatorParameter])}(),function(){function PPreferenceNode(PObject){var pPreferenceNode=function(){PObject.apply(this,arguments)};return pPreferenceNode.prototype=new PObject,pPreferenceNode.prototype.newNode=function(n){var def=$q.defer(),scope=this;return $timeout(function(){var node=new pPreferenceNode;scope.children[n]=section,def.resolve(node)},1),def.promise},pPreferenceNode.prototype.node=function(n){},pPreferenceNode.prototype.nodes=function(p){},pPreferenceNode.prototype.parent=function(){},pPreferenceNode}angular.module("pluf").factory("PPreferenceNode",["PObject",PPreferenceNode])}(),function(){function PPreferenceProperty(PPreferenceNode){var pPreferenceProperty=function(){PPreferenceNode.apply(this,arguments)};return pPreferenceProperty.prototype=new PPreferenceNode,pPreferenceProperty.prototype.setValue=function(v){},pPreferenceProperty.prototype.value=function(){},pPreferenceProperty}angular.module("pluf").factory("PPreferenceProperty",["PPreferenceNode",PPreferenceProperty])}(),function(){function PProcess(PObject){var pProcess=function(){PObject.apply(this,arguments),this.progress||(this.progress={})};return pProcess.prototype.OK=0,pProcess.prototype.INFO=1,pProcess.prototype.WARNING=2,pProcess.prototype.ERROR=4,pProcess.prototype.CANCEL=8,pProcess.prototype.setWorked=function(w){return this.progress.worked=w,this},pProcess.prototype.worked=function(){return this.progress.worked},pProcess.prototype.addWorked=function(w){return this.progress.worked?this.progress.worked+=w:this.progress.worked=w,this},pProcess.prototype.setTotalWork=function(tw){return this.progress.totalWorked=tw,this},pProcess.prototype.totalWork=function(){return this.progress.totalWorked},pProcess.prototype.percentage=function(){return this.progress.totalWorked<=0?0:100*this.progress.worked/this.progress.worked},pProcess.prototype.setTaskName=function(t){return this.progress.taskName=t,this},pProcess.prototype.taskName=function(){return this.progress.taskName},pProcess.prototype.setSubTask=function(st){return this.progress.subTask=st,this},pProcess.prototype.subTask=function(){return this.progress.subTask},pProgressMonitor}angular.module("pluf").factory("PProcess",["PObject",PProcess])}(),function(){function PProfile($http,$httpParamSerializerJQLike,$q,PObject,PException){var pProfile=function(){PObject.apply(this,arguments)};return pProfile.prototype=new PObject,pProfile.prototype.update=function(key,value){if(this.user.isAnonymous()){var deferred=$q.defer();return deferred.reject(),deferred.promise}var scope=this,param={};return param[key]=value,$http({method:"POST",url:"/api/user/profile",data:$httpParamSerializerJQLike(param),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(data){return scope.setData(data),scope},function(data){throw new PException(data)})},pProfile}angular.module("pluf").factory("PProfile",["$http","$httpParamSerializerJQLike","$q","PObject","PException",PProfile])}(),function(){function PUser($http,$q,$httpParamSerializerJQLike,PObject,PProfile,PException){var pUser=function(){PObject.apply(this,arguments)};return pUser.prototype=new PObject,pUser.prototype.update=function(key,value){var scope=($q.defer(),this),param={};return"undefined"!=typeof key&&"undefined"!=typeof value?param[key]=value:param=this,$http({method:"POST",url:"/api/user/"+this.id,data:$httpParamSerializerJQLike(param),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(data){return scope.setData(data.data),scope},function(data){throw new PException(data)})},pUser.prototype.profile=function(){var deferred;if(this.isAnonymous())return deferred=$q.defer(),deferred.reject(),deferred.promise;if(this._prof&&!this._prof.isAnonymous())return deferred=$q.defer(),deferred.resolve(this._prof),deferred.promise;var scope=this;return $http({method:"GET",url:"/api/user/"+this.id+"/profile"}).then(function(res){return scope._prof=new PProfile(res.data),scope._prof.user=scope,scope._prof},function(res){throw new PException(res.data)})},pUser.prototype.isAdministrator=function(){return this.id&&this.id>0&&this.administrator},pUser}angular.module("pluf").factory("PUser",["$http","$q","$httpParamSerializerJQLike","PObject","PProfile","PException",PUser])}(),function(){function act($q,$timeout,PCommand,PHandler){this._commands=[],this.getCommand=function(id){var def=$q.defer(),scope=this;return $timeout(function(){return id in scope._commands?void def.resolve(scope._commands[id]):void def.reject({status:404,code:10,message:"command not found"})},1),def.promise},this.command=function(cmdData){if(!cmdData.id)throw{status:404,code:11,message:"Command id is empty"};var cmd;return cmd=cmdData.id in this._commands?this._commands[cmdData.id]:new PCommand(cmdData),this._commands[cmd.id]=cmd,this},this.handler=function(handData){var cmd;return handData.id in this._commands?cmd=this._commands[handData.id]:(cmd=new PCommand(handData),this._commands[cmd.id]=cmd),cmd.handler(new PHandler(handData)),this},this.execute=function(command){var def=$q.defer();if(command in this._commands){var scope=this,args=Array.prototype.slice.call(arguments).slice(1);$timeout(function(){var cmd=scope._commands[command];cmd.handlers.forEach(function(handler){handler.handle.apply(handler,args)}),def.resolve()},1)}else def.reject({message:"Command not found :"+command,statuse:400,code:4404});return def.promise}}angular.module("pluf").service("$act",["$q","$timeout","PCommand","PHandler",act])}(),function(){function cms($http,$httpParamSerializerJQLike,$q,$timeout,PContent,PNamedContent,PaginatorPage,PException){this._nc={},this._getnc=function(id){return this._nc[id]},this._retnc=function(id,d){var i=this._nc[id];return i?i.setData(d):(i=new PNamedContent(d),this._nc[id]=i),i},this._c={},this._getc=function(id){return this._c[id]},this._retc=function(id,c){var i=this._c[id];return i?i.setData(c):(i=new PContent(c),this._c[c.id]=i),i},this.newContent=function(c){var scope=this;return $http({method:"POST",url:"/api/saascms/content/new",data:$httpParamSerializerJQLike(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(res){return scope._retc(res.data.id,res.data)})},this.content=function(i){var t=this._getc(i);if(t){var deferred=$q.defer();return deferred.resolve(t),deferred.promise}return t=this,$http({method:"GET",url:"/api/saascms/content/"+i}).then(function(res){return t._retc(i,res.data)})},this.contents=function(p){var scope=this;return $http({method:"GET",url:"/api/saascms/contet/find",params:p.getParameter()}).then(function(res){var page=new PaginatorPage(res.data);page.items=[];for(var i=0;i<res.data.counts;i++){var t=scope._retc(page.items[i].id,page.items[i]);page.items.push(t)}return page},function(data){throw new PException(data)})},this.newNamedContent=function(n,c){var nc,scope=this;return $http({method:"POST",url:"/api/saascms/page/new",data:$httpParamSerializerJQLike({content:c.id,name:n}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(res){return nc=scope._retnc(res.data.name,res.data),scope.content(nc.content)}).then(function(c){return nc.content=c,nc})},this.namedContent=function(n){var t=this._getnc(n);if(t){var deferred=$q.defer();return deferred.resolve(t),deferred.promise}var nc,scope=this;return $http({method:"GET",url:"/api/saascms/page/"+n}).then(function(res){return nc=scope._retnc(res.data.name,res.data),scope.content(nc.content)}).then(function(c){return nc.content=c,nc})},this.namedContents=function(p){var scope=this;return $http({method:"GET",url:"/api/saascms/page/find",params:p.getParameter()}).then(function(res){var page=new PaginatorPage(res.data);page.items=[];for(var i=0;i<res.data.counts;i++)page.items.push(scope._retnc(res.data.items[i].name,res.data.items[i]));return page})}}angular.module("pluf").service("$cms",["$http","$httpParamSerializerJQLike","$q","$timeout","PContent","PNamedContent","PaginatorPage","PException",cms])}(),function(){function menu($q,$timeout,PMenu,PMenuItem){this.menus=[],this._addMenu=function(id,menu){id in this.menus||(this.menus[id]=new PMenu({id:id})),this.menus[id].item(menu)},this.menu=function(id){var def=$q.defer(),scope=this;return $timeout(function(){id in scope.menus||(scope.menus[id]=new PMenu({id:id})),def.resolve(scope.menus[id])},1),def.promise},this.addItem=function(id,menu){return this._addMenu(id,new PMenuItem(menu)),this}}angular.module("pluf").service("$menu",["$q","$timeout","PMenu","PMenuItem",menu])}(),function(){function notify($rootScope,$timeout,$q,PMessage){this._listeners=[],this._fire=function(list,m){var deferred=$q.defer(),ms=[];return ms.push(new PMessage(m)),$timeout(function(){for(var i=0;i<list.length;i++)list[i].apply(list[i],ms);deferred.resolve()},10),deferred.promise},this.onMessage=function(l){return this._listeners.push(l),this},this.info=function(message){return message.type="info",this._fire(this._listeners,message)},this.warning=function(message){return message.type="warning",this._fire(this._listeners,message)},this.debug=function(message){return message.type="debug",this._fire(this._listeners,message)},this.error=function(message){return message.type="error",this._fire(this._listeners,message)}}angular.module("pluf").service("$notify",["$rootScope","$timeout","$q","PMessage",notify])}(),function(){function preference($rootScope){this.newNode=function(n){},this.node=function(path){},this.nodes=function(p){}}angular.module("pluf").service("$preference",["$rootScope",preference])}(),function(){function process(){this.processes=function(){},this.process=function(id){}}angular.module("pluf").service("$process",[process])}(),function(){function user($http,$httpParamSerializerJQLike,$q,$act,PUser){this._su=new PUser,this._u={},this._getUser=function(id){return this._u[id]&&!this._u[id].isAnonymous()?this._u[id]:null},this._ret=function(id,data){var instance=this._getUser(id);return instance?instance.setData(data):(instance=new PUser(data),this._u[id]=instance),instance},this.isAnonymous=function(){return this._su.isAnonymous()},this.isAdministrator=function(){return this._su.isAdministrator()},this.login=function(c){if(!this.isAnonymous()){var deferred=$q.defer();return deferred.resolve(this),deferred.promise}var scope=this;return $http({method:"POST",url:"/api/user/login",data:$httpParamSerializerJQLike(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(data){return scope._su=new PUser(data.data),scope._su})},this.session=function(){var scope=this;if(!this.isAnonymous()){var deferred=$q.defer();return deferred.resolve(this._su),deferred.promise}return $http.get("/api/user/account").then(function(data){return scope._su=new PUser(data.data),scope._su})},this.logout=function(){if(this.isAnonymous()){var deferred=$q.defer();return deferred.resolve(this._su),deferred.promise}var scope=this;return $http.get("/api/user/logout").success(function(data){return scope._su.setData({id:0,login:null,administrator:!1}),scope._su})},this.signup=function(detail){return $http({method:"POST",url:"/api/user/signup",data:$httpParamSerializerJQLike(detail),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(data){var user=new PUser(data.data);return user})},this.users=function(p){var scope=this;return $http({method:"GET",url:"/api/user/find",params:p.getParameter()}).then(function(data){for(var page=new PaginatorPage(res.data),items=[],i=0;i<page.counts;i++){var t=scope._ret(page.items[i].id,page.items[i]);items.push(t)}return page.items=items,page})},this.user=function(login){var scope=this;return $http({method:"GET",url:"/api/user/user/"+login}).then(function(data){return scope._ret(data.data.id,data.data)})}}angular.module("pluf").service("$usr",["$http","$httpParamSerializerJQLike","$q","$act","PUser",user])}(),function(){function PApplication($http,$q,$window,PApplicationDetail,PObject){var pApplication=function(){PObject.apply(this,arguments)};return pApplication.prototype=new PObject,pApplication.prototype.setTenant=function($t){return this._tenant=$t,this},pApplication.prototype.detail=function(){if(this._detail){var def=$q.defer();return def.resolve(this._detail),def.promise}var scope=this;return $http({method:"GET",url:"/api/saas/spa/"+this.id+"/detail"}).then(function(res){return scope._detail=new PApplicationDetail(res.data),scope._detail},function(data){throw new PException(data)})},pApplication.prototype.run=function(){$window.location=$window.location.origin+"/"+this._tenant.id+"/"+this.id},pApplication}angular.module("pluf.saas").factory("PApplication",["$http","$q","$window","PApplicationDetail","PObject",PApplication])}(),function(){function PApplicationDetail($http,$q,$window,PObject){var pApplicationDetail=function(){PObject.apply(this,arguments)};return pApplicationDetail.prototype=new PObject,pApplicationDetail}angular.module("pluf.saas").factory("PApplicationDetail",["$http","$q","$window","PObject",PApplicationDetail])}(),function(){function PTenant($http,$httpParamSerializerJQLike,$location,$window,$q,PObject,PException,PProfile,PApplication,PaginatorParameter,PaginatorPage){var pTenant=function(){PObject.apply(this,arguments)};return pTenant.prototype=new PObject,pTenant.prototype._pool=[],pTenant.prototype.ret=function(d){var t;return d.id in this._pool?(t=this._pool[d.id],t.setData(d),t):(t=new PApplication(d).setTenant(this),this._pool[t.id]=t,t)},pTenant.prototype.update=function(key,value){var scope=this,par={};return par[key]=value,$http({method:"POST",url:"/api/saas/"+this.id,data:$httpParamSerializerJQLike(par),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(res){return scope.setData(res.data),scope},function(data){throw new PException(data)})},pTenant.prototype.members=function(){if(this.isAnonymous()||this.memberLoaded()){var deferred=$q.defer();return this.isAnonymous()?deferred.reject("authentication requried"):deferred.resolve(this._member),deferred.promise}var scope=tenantService;return $http({method:"GET",url:"/api/saas/app/"+$application.id+"/member/list"}).then(function(res){return scope.$member.setData(res.data),scope.$member},function(data){throw new PException(data)})},pTenant.prototype.apps=function($params){$params||($params=new PaginatorParameter);var scope=this;return $http({method:"GET",url:"/api/"+this.id+"/saas/spa/find",params:$params.getParameter()}).then(function(res){for(var page=new PaginatorPage(res.data),items=[],i=0;i<page.counts;i++){var t=scope.ret(page.items[i]);items.push(t)}return page.items=items,page},function(data){throw new PException(data)})},pTenant.prototype.app=function(appName){var scope=this;return $http({method:"GET",url:"/api/saas/spa/"+appName}).then(function(res){var t=scope.ret(res.data);return t},function(data){throw new PException(data)})},pTenant.prototype.run=function(){$window.location=$window.location.origin+"/"+this.id},pTenant}angular.module("pluf.saas").factory("PTenant",["$http","$httpParamSerializerJQLike","$location","$window","$q","PObject","PException","PProfile","PApplication","PaginatorParameter","PaginatorPage",PTenant])}(),function(){function tenant($http,$httpParamSerializerJQLike,$q,$window,$act,$usr,PTenant,PApplication,PException,PaginatorParameter,PaginatorPage){this._tenant=[],this.ret=function(d){var t;return d.id in this._tenant?(t=this._tenant[d.id],t.setData(d),t):(t=new PTenant(d),this._tenant[t.id]=t,t)},this.session=function(){var scope=this;return $http.get("/api/saas/current").then(function(res){return scope.ret(res.data)},function(res){throw new PException(res.data)})},this.get=function(id){var scope=this;return $http.get("/api/saas/app/"+id).then(function(res){return scope.ret(res.data)},function(res){throw new PException(res.data)})},this.create=function(t){var scope=this;return $http({method:"POST",url:"/api/saas/app/create?XDEBUG_SESSION_START=ECLIPSE_DBGP&KEY=14513358957011",data:$httpParamSerializerJQLike(t),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(res){return scope.ret(res.data)},function(res){throw new PException(res.data)})},this.tenants=function($params){var scope=this;return $http({method:"GET",url:"/api/saas/app/list",params:$params.getParameter()}).then(function(res){var page=new PaginatorPage(res.data);page.items=[];for(var i=0;i<page.counts;i++){var t=scope.ret(res.data.items[i]);page.items.push(t)}return page},function(data){throw new PException(data)})},this.mine=function(param){param||(param=new PaginatorParameter);var scope=this;return $http({method:"GET",url:"/api/saas/app/userList",params:param.getParameter()}).then(function(res){var page=new PaginatorPage(res.data);page.items=[];for(var i=0;i<page.counts;i++){var t=scope.ret(res.data.items[i]);page.items.push(t)}return page},function(data){throw new PException(data)})}}angular.module("pluf.saas").service("$tenant",["$http","$httpParamSerializerJQLike","$q","$window","$act","$usr","PTenant","PApplication","PException","PaginatorParameter","PaginatorPage",tenant])}(),function(){function PFollower(PObject,PException){pFollower.prototype=new PObject;var pFollower=function(){PObject.apply(this,arguments)};return pFollower}angular.module("pluf.social").factory("PFollower",["PObject","PException",PFollower])}(),function(){function news($httpParamSerializerJQLike,$http,$q,PException,PFollower,PaginatorPage){this._df=[],this._getf=function(i){return this._df[i]},this._retf=function(id,d){var i=this._getf(id);return i?(i.setData(d),i):(this._df[id]=new PFollower(d),this._df[id])},this.validateFollower=function(f){var def=$q.defer(),re=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(re.test(f))return def.resolve({type:"email",address:f}),def.promise;var mob=/^\+?\d{10,14}$/;return mob.test(f)?(def.resolve({type:"mobile",address:f}),def.promise):(def.resolve({type:"other",address:f}),def.promise)},this.newFollower=function(f){var scope=this;return $http({method:"POST",url:"/api/newspaper/follower/new",data:$httpParamSerializerJQLike(f),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(res){return scope._retf(res.data.id,res.data)})},this.followers=function(p){var scope=this;return $http({method:"GET",url:"/api/newspaper/follower/find",params:p.getParameter()}).then(function(res){var page=new PaginatorPage(res.data);page.items=[];for(var i=0;i<res.data.counts;i++)page.items.push(scope._retf(res.data.items[i].id,res.data.items[i]));return page})},this.follower=function(i){}}angular.module("pluf.social").service("$news",["$httpParamSerializerJQLike","$http","$q","PException","PFollower","PaginatorPage",news])}(),function(){function PWikiBook(PObject,PException,PWikiPageItem,PaginatorPage,$http,$q,$timeout){var pWikiBook=function(){PObject.apply(this,arguments)};return pWikiBook.prototype=new PObject,pWikiBook.prototype._retItem=function(id,data){var item=null;for(var i in this.items)if(this.items[i].id==id){item=this.items[i];break}return item||(item=new PWikiPageItem(data),this.items.push(item)),item.setData(data),item},pWikiBook.prototype.firstPage=function(){var def=$q.defer(),scope=this;return $timeout(function(){def.resolve(scope.items[0])},1),def.promise},pWikiBook.prototype.pages=function(){var scope=this;return $http({method:"GET",url:"/api/wiki/book/"+scope.id+"/pages"}).then(function(res){scope.items=[];for(var i=0;i<res.data.length;i++)scope._retItem(res.data[i].id,res.data[i]);return scope.items},function(data){throw new PException(data)})},pWikiBook.prototype.addPage=function(page){if(page.isAnonymous()){var dif=$q.defer();return $timeout(function(){var ex=new PException({message:"Page id is null!"});dif.reject(ex)},1),dif.promise}var scope=this;return $http({method:"POST",url:"/api/wiki/book/"+scope.id+"/page/"+page.id}).then(function(res){return scope},function(data){throw new PException(data)})},pWikiBook.prototype.removePage=function(page){if(page.isAnonymous()){var dif=$q.defer();return $timeout(function(){var ex=new PException({message:"Page id is null!"});dif.reject(ex)},1),dif.promise}var scope=this;return $http({method:"DELETE",url:"/api/wiki/book/"+scope.id+"/page/"+page.id}).then(function(res){return scope},function(data){throw new PException(data)})},pWikiBook.prototype.update=function(b){var scope=this;return $http({method:"POST",url:"/api/wiki/book/"+scope.id,data:$httpParamSerializerJQLike(b),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(res){return scope.setData(res.data),scope},function(data){throw new PException(data)})},pWikiBook.prototype.remove=function(){var scope=this;return $http({method:"DELETE",url:"/api/wiki/book/"+scope.id}).then(function(res){return scope.setData(res.data),scope},function(data){throw new PException(data)})},pWikiBook}angular.module("pluf.wiki").factory("PWikiBook",["PObject","PException","PWikiPageItem","PaginatorPage","$http","$q","$timeout",PWikiBook])}(),function(){function PWikiPage(PObject){var wikiPage=function(d){d&&this.setData(d)};return wikiPage.prototype=new PObject,wikiPage.prototype.update=function(p){var scope=this;return $http({method:"POST",url:"/api/wiki/page/"+p.id,data:$httpParamSerializerJQLike(p),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(res){return scope.setData(res.data),scope},function(data){throw new PException(data)})},wikiPage.prototype.remove=function(){var scope=this;return $http({method:"DELETE",url:"/api/wiki/page/"+scope.id}).then(function(res){return scope.setData(res.data),scope},function(data){throw new PException(data)})},wikiPage.prototype.toHTML=function(){return markdown.toHTML(this.content)},wikiPage}angular.module("pluf.wiki").factory("PWikiPage",["PObject",PWikiPage])}(),function(){function PWikiPageItem(PObject){var wikiPageItem=function(d){d&&this.setData(d)};return wikiPageItem.prototype=new PObject,wikiPageItem.prototype.page=function(){},wikiPageItem}angular.module("pluf.wiki").factory("PWikiPageItem",["PObject",PWikiPageItem])}(),function(){function unsafe($sce){return function(val){return $sce.trustAsHtml(val)}}angular.module("pluf.wiki").filter("unsafe",["$sce",unsafe])}(),function(){function help($http,$httpParamSerializerJQLike,$q,PException,PWikiPage,PWikiBook,PaginatorPage){this._ppage={},this._getPage=function(id){return this._ppage[id]},this._setPage=function(page){this._ppage[page.id]=page},this._retPage=function(id,data){var instance=this._getPage(id);return instance?instance.setData(data):(instance=new PWikiPage(data),this._setPage(instance)),instance},this._pbook={},this._getBook=function(id){return this._pbook[id]},this._setBook=function(page){this._pbook[page.id]=page},this._retBook=function(id,data){var instance=this._getBook(id);return instance?instance.setData(data):(instance=new PWikiBook(data),this._setBook(instance)),instance},this.books=function(p){var scope=this;return $http({method:"GET",url:"/api/wiki/book/find",params:p.getParameter()}).then(function(res){for(var page=new PaginatorPage(res.data),items=[],i=0;i<page.counts;i++){var t=scope._retBook(page.items[i].id,page.items[i]);items.push(t)}return page.items=items,page},function(data){throw new PException(data)})},this.book=function(id){var scope=this;return $http({method:"GET",url:"/api/wiki/book/"+id}).then(function(res){var book=scope._retBook(res.data.id,res.data);return book},function(data){throw new PException(data)})},this.createBook=function(b){var scope=this;return $http({method:"POST",url:"/api/wiki/book/create",data:$httpParamSerializerJQLike(b),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(res){var t=scope._retBook(res.data.id,res.data);return t},function(data){throw new PException(data)})},this.pages=function(p){var scope=this;return $http({method:"GET",url:"/api/wiki/page/find",params:p.getParameter()}).then(function(res){for(var page=new PaginatorPage(res.data),items=[],i=0;i<page.counts;i++){var t=scope._retPage(page.items[i].id,page.items[i]);items.push(t)}return page.items=items,page},function(data){throw new PException(data)})},this.page=function(id){var scope=this;return $http({method:"GET",url:"/api/wiki/page/"+id}).then(function(res){var page=scope._retPage(res.data.id,res.data);return page},function(data){throw new PException(data)})},this.createPage=function(p){var scope=this;return $http({method:"POST",
url:"/api/wiki/page/create",data:$httpParamSerializerJQLike(p),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(res){var t=scope._retPage(res.data.id,res.data);return t},function(data){throw new PException(data)})}}angular.module("pluf.wiki").service("$help",["$http","$httpParamSerializerJQLike","$q","PException","PWikiPage","PWikiBook","PaginatorPage",help])}();