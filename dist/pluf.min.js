/*! angular-pluf 2016-05-25 */
!function(){angular.module("pluf",[]).run(function($usr,$act){$act.command({id:"pluf.user.login",label:"login",description:"login a user",visible:function(){return $usr.isAnonymous()},category:"usr"}).commandHandler({commandId:"pluf.user.login",handle:function(){if(arguments.length<1)throw new PException("no credentioal");var a=arguments[0];return $usr.login(a.username,a.password)}}).command({id:"pluf.user.logout",label:"logout",description:"logout the user",visible:function(){return!$usr.isAnonymous()},category:"usr"}).commandHandler({commandId:"pluf.user.logout",handle:function(){return $usr.logout()}}).command({id:"pluf.user.update",label:"update",description:"update the current user",visible:function(){return!$usr.isAnonymous()}}).commandHandler({commandId:"pluf.user.update",handle:function(){if(arguments.length<1)throw new PException("bad param");var a=arguments[0];return $usr.session().then(function(user){return user.update(a.key,a.value)})}}).command({id:"pluf.user.profile.update",label:"update profile",description:"update user profile",visible:function(){return!$usr.isAnonymous()}}).commandHandler({commandId:"pluf.user.profile.update",handle:function(){if(arguments.length<1)throw new PException("bad param");var a=arguments[0];return $usr.session().then(function(user){return user.profile()}).then(function(profile){return profile.update(a.key,a.value)})}})})}(),function(){function PContent($http,$httpParamSerializerJQLike,$q,PObject,PException){var pContent=function(){PObject.apply(this,arguments)};return pContent.prototype=new PObject,pContent.prototype.update=function(){},pContent.prototype.remove=function(){},pContent.prototype.value=function(){return $http({method:"GET",url:"/api/saascms/content/"+this.id+"/download"}).then(function(res){return res.data})},pContent.prototype.setValue=function(d){var scope=this;return $http({method:"POST",url:"/api/saascms/content/"+this.id+"/download",data:d}).then(function(res){return scope})},pContent}angular.module("pluf").factory("PContent",["$http","$httpParamSerializerJQLike","$q","PObject","PException",PContent])}(),function(){function PException(PObject){var pException=function(){PObject.apply(this,arguments)};return pException.prototype=new PObject,pException}angular.module("pluf").factory("PException",["PObject",PException])}(),function(){function PNamedContent($http,$httpParamSerializerJQLike,$q,PObject,PException,PContent){var pNamedContent=function(){PObject.apply(this,arguments)};return pNamedContent.prototype=new PObject,pNamedContent.prototype.update=function(){},pNamedContent.prototype.remove=function(){},pNamedContent.prototype.value=function(){return this.content.value()},pNamedContent.prototype.setValue=function(v){return this.content.setValue(v)},pNamedContent}angular.module("pluf").factory("PNamedContent",["$http","$httpParamSerializerJQLike","$q","PObject","PException","PContent",PNamedContent])}(),function(){function PObject(){var pObject=function(data){data&&this.setData(data)};return pObject.prototype={setData:function(data){angular.extend(this,data)},isAnonymous:function(){return!(this.id&&this.id>0)}},pObject}angular.module("pluf").factory("PObject",[PObject])}(),function(){function PPreferenceNode(PObject){var pPreferenceNode=function(){PObject.apply(this,arguments)};return pPreferenceNode.prototype=new PObject,pPreferenceNode.prototype.newNode=function(n){var def=$q.defer(),scope=this;return $timeout(function(){var node=new pPreferenceNode;scope.children[n]=section,def.resolve(node)},1),def.promise},pPreferenceNode.prototype.node=function(n){},pPreferenceNode.prototype.nodes=function(p){},pPreferenceNode.prototype.parent=function(){},pPreferenceNode}angular.module("pluf").factory("PPreferenceNode",["PObject",PPreferenceNode])}(),function(){function PPreferenceProperty(PPreferenceNode){var pPreferenceProperty=function(){PPreferenceNode.apply(this,arguments)};return pPreferenceProperty.prototype=new PPreferenceNode,pPreferenceProperty.prototype.setValue=function(v){},pPreferenceProperty.prototype.value=function(){},pPreferenceProperty}angular.module("pluf").factory("PPreferenceProperty",["PPreferenceNode",PPreferenceProperty])}(),function(){function PProfile($http,$httpParamSerializerJQLike,$q,PObject,PException){var pProfile=function(){PObject.apply(this,arguments)};return pProfile.prototype=new PObject,pProfile.prototype.update=function(key,value){if(this.user.isAnonymous()){var deferred=$q.defer();return deferred.reject(),deferred.promise}var scope=this,param={};return param[key]=value,$http({method:"POST",url:"/api/user/profile",data:$httpParamSerializerJQLike(param),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(data){return scope.setData(data),scope},function(data){throw new PException(data)})},pProfile}angular.module("pluf").factory("PProfile",["$http","$httpParamSerializerJQLike","$q","PObject","PException",PProfile])}(),function(){function PProgressMonitor(PObject){var pProgressMonitor=function(data){data&&(this._s=1,this._tw=100,this._t=0,this.setData(data))};return pProgressMonitor.prototype={WAIT:0,WORKING:1,FINISH:2,ERROR:3,setWorked:function(w){return this._w=w,this},addWorked:function(w){return this._w?this._w+=w:this._w=w,this},worked:function(){return this._w},setTotalWork:function(tw){return this._tw=tw,this},totalWork:function(){return this._tw},percentage:function(){return 100*this._w/this._tw},setTask:function(t){return this._t=t,this},task:function(){return this._t},setSubTask:function(st){return this._st=st,this},subTask:function(){return this._st},setState:function(s){return this._s=s,this},state:function(){return this._s},isDone:function(){return this._s==this.FINISH}},pProgressMonitor}angular.module("pluf").factory("PProgressMonitor",["PObject",PProgressMonitor])}(),function(){function PUser($http,$q,$httpParamSerializerJQLike,PObject,PProfile,PException){var pUser=function(){PObject.apply(this,arguments)};return pUser.prototype=new PObject,pUser.prototype.update=function(key,value){var scope=($q.defer(),this),param={};return"undefined"!=typeof key&&"undefined"!=typeof value?param[key]=value:param=this,$http({method:"POST",url:"/api/user/"+this.id,data:$httpParamSerializerJQLike(param),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(data){return scope.setData(data.data),scope},function(data){throw new PException(data)})},pUser.prototype.profile=function(){var deferred;if(this.isAnonymous())return deferred=$q.defer(),deferred.reject(),deferred.promise;if(this._prof&&!this._prof.isAnonymous())return deferred=$q.defer(),deferred.resolve(this._prof),deferred.promise;var scope=this;return $http({method:"GET",url:"/api/user/"+this.id+"/profile"}).then(function(res){return scope._prof=new PProfile(res.data),scope._prof.user=scope,scope._prof},function(res){throw new PException(res.data)})},pUser.prototype.isAdministrator=function(){return this.id&&this.id>0&&this.administrator},pUser}angular.module("pluf").factory("PUser",["$http","$q","$httpParamSerializerJQLike","PObject","PProfile","PException",PUser])}(),function(){function PaginatorPage(PObject){var paginatorPage=function(){PObject.apply(this,arguments)};return paginatorPage.prototype=new PObject,paginatorPage}angular.module("pluf").factory("PaginatorPage",["PObject",PaginatorPage])}(),function(){function PaginatorParameter(){var pagParam=function(paginatorParam){paginatorParam?this.setData(paginatorParam):this.setData({})};return pagParam.prototype={param:{},setData:function(paginatorParam){this.param=paginatorParam},setSize:function($size){return this.param._px_c=$size,this},setQuery:function($query){return this.param._px_q=$query,this},setPage:function($page){return this.param._px_p=$page,this},setOrder:function($key,$order){return this.param._px_sk=$key,this.param._px_so=$order,this},setFilter:function($key,$value){return this.param._px_fk=$key,this.param._px_fv=$value,this},getParameter:function(){return this.param}},pagParam}angular.module("pluf").factory("PaginatorParameter",[PaginatorParameter])}(),function(){function act($q,$timeout,PException){this._categories=[],this._commands=[],this._handlers=[],this.getCommand=function(id){var def=$q.defer(),scope=this;return $timeout(function(){for(var i=0;i<scope._commands.length;i++)if(scope._commands[i].id==id)return void def.resolve(scope._commands[i])},1),def.promise},this.category=function(key){var def=$q.defer(),scope=this;return $timeout(function(){key in scope._categories||(scope._categories[key]=[]),def.resolve(scope._categories[key])},1),def.promise},this.command=function($c){if(this._commands.push($c),"visible"in $c||($c.visible=function(){return!0}),"enable"in $c||($c.enable=function(){return!0}),"priority"in $c||($c.priority=0),$c.category&&($c.category in this._categories||(this._categories[$c.category]=[]),this._categories[$c.category].push($c)),$c.categories)for(var i=0;i<$c.categories.length;++i)$c.categories[i]in this._categories||(this._categories[$c.categories[i]]=[]),this._categories[$c.categories[i]].push($c);return this},this.commandHandler=function($ch){return $ch.commandId in this._handlers||(this._handlers[$ch.commandId]=[]),this._handlers[$ch.commandId].push($ch),this},this.execute=function($ci){var scope=this,args=Array.prototype.slice.call(arguments);if(args=args.slice(1),!($ci in scope._handlers)){var def=$q.defer();return def.reject(new PException({message:"Command not found :"+$ci,statuse:400,code:4404})),def.promise}for(var promises=[],i=0;i in scope._handlers[$ci];i++){var handler=scope._handlers[$ci][i];promises.push(handler.handle.apply(handler,args))}return $q.all(promises)}}angular.module("pluf").service("$act",["$q","$timeout","PException",act])}(),function(){function cms($http,$httpParamSerializerJQLike,$q,$timeout,PContent,PNamedContent,PaginatorPage,PException){this._nc={},this._getnc=function(id){return this._nc[id]},this._retnc=function(id,d){var i=this._nc[id];return i?i.setData(d):(i=new PNamedContent(d),this._nc[id]=i),i},this._c={},this._getc=function(id){return this._c[id]},this._retc=function(id,c){var i=this._c[id];return i?i.setData(c):(i=new PContent(c),this._c[c.id]=i),i},this.newContent=function(c){var scope=this;return $http({method:"POST",url:"/api/saascms/content/new",data:$httpParamSerializerJQLike(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(res){return scope._retc(res.data.id,res.data)})},this.content=function(i){var t=this._getc(i);if(t){var deferred=$q.defer();return deferred.resolve(t),deferred.promise}return t=this,$http({method:"GET",url:"/api/saascms/content/"+i}).then(function(res){return t._retc(i,res.data)})},this.contents=function(p){var scope=this;return $http({method:"GET",url:"/api/saascms/contet/find",params:p.getParameter()}).then(function(res){var page=new PaginatorPage(res.data);page.items=[];for(var i=0;i<res.data.counts;i++){var t=scope._retc(page.items[i].id,page.items[i]);page.items.push(t)}return page},function(data){throw new PException(data)})},this.newNamedContent=function(n,c){var nc,scope=this;return $http({method:"POST",url:"/api/saascms/page/new",data:$httpParamSerializerJQLike({content:c.id,name:n}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(res){return nc=scope._retnc(res.data.name,res.data),scope.content(nc.content)}).then(function(c){return nc.content=c,nc})},this.namedContent=function(n){var t=this._getnc(n);if(t){var deferred=$q.defer();return deferred.resolve(t),deferred.promise}var nc,scope=this;return $http({method:"GET",url:"/api/saascms/page/"+n}).then(function(res){return nc=scope._retnc(res.data.name,res.data),scope.content(nc.content)}).then(function(c){return nc.content=c,nc})},this.namedContents=function(p){var scope=this;return $http({method:"GET",url:"/api/saascms/page/find",params:p.getParameter()}).then(function(res){var page=new PaginatorPage(res.data);page.items=[];for(var i=0;i<res.data.counts;i++)page.items.push(scope._retnc(res.data.items[i].name,res.data.items[i]));return page},function(data){throw new PException(data)})}}angular.module("pluf").service("$cms",["$http","$httpParamSerializerJQLike","$q","$timeout","PContent","PNamedContent","PaginatorPage","PException",cms])}(),function(){function menu($q,$timeout,$act,$window){this._menus=[],this._addMenu=function(id,menu){id in this._menus||(this._menus[id]=[]),"visible"in menu||(menu.visible=function(){return!0}),"enable"in menu||(menu.enable=function(){return!0}),this._menus[id].push(menu)},this.menu=function(id){var def=$q.defer(),scope=this;return $timeout(function(){id in scope._menus||(scope._menus[id]=[]),def.resolve(scope._menus[id])},1),def.promise},this.add=function(id,menu){if("command"in menu){var scope=this;$act.getCommand(menu.command).then(function(command){menu.active=function(){if(menu.params instanceof Array){var args=[];args.push(menu.command);for(var i=0;i<menu.params.length;i++)args.push(menu.params[i]);return $act.execute.apply($act,args)}return $act.execute(menu.command)},"enable"in menu||(menu.enable=function(){return command.enable}),!("label"in menu)&&"label"in command&&(menu.label=command.label),"priority"in menu||(menu.priority=command.priority),"description"in menu||(menu.priority=command.description),"visible"in menu||(menu.visible=command.visible),scope._addMenu(id,menu)})}else"action"in menu?(menu.active=function(){return menu.action()},this._addMenu(id,menu)):"link"in menu&&(menu.active=function(){$window.location=menu.link},this._addMenu(id,menu));return this}}angular.module("pluf").service("$menu",["$q","$timeout","$act","$window",menu])}(),function(){function notify($rootScope,$timeout,$q){this._info=[],this._warning=[],this._debug=[],this._error=[],this._fire=function(list,args){var deferred=$q.defer();return $timeout(function(){for(var i=0;i<list.length;i++)list[i].apply(list[i],args);deferred.resolve()},10),deferred.promise},this.onInfo=function(listener){return this._info.push(listener),this},this.info=function(){return this._fire(this._info,arguments)},this.onWarning=function(listener){return this._warning.push(listener),this},this.warning=function(){return this._fire(this._warning,arguments)},this.onDebug=function(listener){return this._debug.push(listener),this},this.debug=function(){return this._fire(this._debug,arguments)},this.onError=function(listener){return this._error.push(listener),this},this.error=function(){return this._fire(this._error,arguments)},this.broadcast=function(){return $rootScope.$broadcast.apply($rootScope,arguments)}}angular.module("pluf").service("$notify",["$rootScope","$timeout","$q",notify])}(),function(){function preference($rootScope){this.newNode=function(n){},this.node=function(path){},this.nodes=function(p){}}angular.module("pluf").service("$preference",["$rootScope",preference])}(),function(){function user($http,$httpParamSerializerJQLike,$q,$act,PUser,PException){this._su=new PUser,this._u={},this._getUser=function(id){return this._u[id]},this._setUser=function(u){this._u[u.id]=u},this._ret=function(id,data){var instance=this._getUser(id);return instance?instance.setData(data):(instance=new PUser(data),this._setUser(instance)),instance},this.isAnonymous=function(){return this._su.isAnonymous()},this.isAdministrator=function(){return this._su.isAdministrator()},this.login=function($login,$password){if(!this.isAnonymous()){var deferred=$q.defer();return deferred.resolve(this),deferred.promise}var scope=this;return $http({method:"POST",url:"/api/user/login",data:$httpParamSerializerJQLike({login:$login,password:$password}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(){return scope.session()},function(data){throw new PException(data)}).then(function(data){return data},function(data){throw new PException(data)})},this.session=function(){var scope=this;if(!this._su.isAnonymous()){var deferred=$q.defer();return deferred.resolve(this._su),deferred.promise}return $http.get("/api/user/account").then(function(data){return scope._su=new PUser(data.data),scope._su},function(data){throw new PException(data)})},this.logout=function(){if(this.isAnonymous()){var deferred=$q.defer();return deferred.resolve(this),deferred.promise}var scope=this;return $http.get("/api/user/logout").success(function(data){return scope._su.setData({id:0,login:null,administrator:!1}),scope._su}).error(function(data){throw new PException(data)})},this.signup=function(detail){return $http({method:"POST",url:"/api/user/signup",data:$httpParamSerializerJQLike(detail),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(data){var user=new PUser(data.data);return user},function(data){throw new PException(data)})},this.users=function(p){var scope=this;return $http({method:"GET",url:"/api/user/find",params:p.getParameter()}).then(function(data){for(var page=new PaginatorPage(res.data),items=[],i=0;i<page.counts;i++){var t=scope._ret(page.items[i].id,page.items[i]);items.push(t)}return page.items=items,page},function(data){throw new PException(data)})},this.user=function(login){var scope=this;return $http({method:"GET",url:"/api/user/user/"+login}).then(function(data){var t=scope._ret(data.data.id,data.data);return t},function(data){throw new PException(data)})}}angular.module("pluf").service("$usr",["$http","$httpParamSerializerJQLike","$q","$act","PUser","PException",user])}();