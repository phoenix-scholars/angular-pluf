/*! angular-pluf 2016-05-12 */
"use strict";angular.module("pluf.jahanjoo",["pluf"]).factory("PTag",function(PObject,PException){var pTag=function(){pTag.apply(this,arguments)};return pTag.prototype=new PObject,pTag}).factory("PVote",function(PObject,PException){var pVote=function(){PObject.apply(this,arguments)};return pVote.prototype=new PObject,pVote}).factory("PLocation",function($http,PObject,PException){var pLocation=function(){PObject.apply(this,arguments)};return pLocation.prototype=new PObject,pLocation.prototype.remove=function(){var scope=this;return $http({method:"DELETE",url:"/api/jayab/location/"+this.id}).then(function(res){return scope.id=0,scope},function(res){throw new PException("fail to delete the location.",res.data)})},pLocation}).service("$jlocation",function($rootScope,$http,$q,$window,$usr,PLocation,PaginatorPage,PException){this._pool=[],this.ret=function(d){if(d.id in this._pool){var t=this._pool[d.id];return t.setData(d),t}var t=new PLocation(d);return this._pool[t.id]=t,t},this.location=function(i){if(i in this._pool){var d=$q.defer();return d.resolve(this._pool[i]),d.promise}var scope=this;return $http({method:"GET",url:"/api/jayab/location/"+i}).then(function(res){return scope.ret(res.data)},function(res){throw new PException("fail to get locations.",res.data)})},this.locations=function(p){var scope=this;return $http({method:"GET",url:"/api/jayab/location/list",params:p.getParameter()}).then(function(res){for(var page=new PaginatorPage(res.data),items=[],i=0;i<page.counts;i++){var t=scope.ret(page.items[i]);items.push(t)}return page.items=items,page},function(res){throw new PException("fail to get locations.",res.data)})},this.add=function(p){var scope=this;return $http({method:"POST",url:"/api/jayab/location/create",params:p,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(res){return scope.ret(res.data)},function(res){throw new PException("fail to add location.",res.data)})}});