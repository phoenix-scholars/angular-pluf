/*! angular-pluf 2016-05-23 */
"use strict";angular.module("pluf.saas",["pluf"]).factory("PApplicationDetail",function($http,$q,$window,PObject){var pApplicationDetail=function(){PObject.apply(this,arguments)};return pApplicationDetail.prototype=new PObject,pApplicationDetail}).factory("PApplication",function($http,$q,$window,PApplicationDetail,PObject){var pApplication=function(){PObject.apply(this,arguments)};return pApplication.prototype=new PObject,pApplication.prototype.setTenant=function($t){return this._tenant=$t,this},pApplication.prototype.detail=function(){if(this._detail){var def=$q.defer();return def.resolve(this._detail),def.promise}var scope=this;return $http({method:"GET",url:"/api/saas/spa/"+this.id+"/detail"}).then(function(res){return scope._detail=new PApplicationDetail(res.data),scope._detail},function(data){throw new PException(data)})},pApplication.prototype.run=function(){$window.location=$window.location.origin+"/"+this._tenant.id+"/"+this.id},pApplication}).factory("PTenant",function($http,$httpParamSerializerJQLike,$location,$window,$q,PObject,PException,PProfile,PApplication,PaginatorParameter,PaginatorPage){var pTenant=function(){PObject.apply(this,arguments)};return pTenant.prototype=new PObject,pTenant.prototype._pool=[],pTenant.prototype.ret=function(d){if(d.id in this._pool){var t=this._pool[d.id];return t.setData(d),t}var t=new PApplication(d).setTenant(this);return this._pool[t.id]=t,t},pTenant.prototype.update=function(key,value){var scope=this,par={};return par[key]=value,$http({method:"POST",url:"/api/saas/"+this.id,data:$httpParamSerializerJQLike(par),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(res){return scope.setData(res.data),scope},function(data){throw new PException(data)})},pTenant.prototype.members=function(){if(this.isAnonymous()||this.memberLoaded()){var deferred=$q.defer();return this.isAnonymous()?deferred.reject("authentication requried"):deferred.resolve(this._member),deferred.promise}var scope=tenantService;return $http({method:"GET",url:"/api/saas/app/"+$application.id+"/member/list"}).then(function(res){return scope.$member.setData(res.data),scope.$member},function(data){throw new PException(data)})},pTenant.prototype.apps=function($params){$params||($params=new PaginatorParameter);var scope=this;return $http({method:"GET",url:"/api/"+this.id+"/saas/spa/find",params:$params.getParameter()}).then(function(res){for(var page=new PaginatorPage(res.data),items=[],i=0;i<page.counts;i++){var t=scope.ret(page.items[i]);items.push(t)}return page.items=items,page},function(data){throw new PException(data)})},pTenant.prototype.app=function(appName){var scope=this;return $http({method:"GET",url:"/api/saas/spa/"+appName}).then(function(res){var t=scope.ret(res.data);return t},function(data){throw new PException(data)})},pTenant.prototype.run=function(){$window.location=$window.location.origin+"/"+this.id},pTenant}).service("$tenant",function($http,$httpParamSerializerJQLike,$q,$window,$act,$usr,PTenant,PApplication,PException,PaginatorParameter,PaginatorPage){this._tenant=[],this.ret=function(d){if(d.id in this._tenant){var t=this._tenant[d.id];return t.setData(d),t}var t=new PTenant(d);return this._tenant[t.id]=t,t},this.session=function(){var scope=this;return $http.get("/api/saas/curent").then(function(res){return scope.ret(res.data)},function(res){throw new PException(res.data)})},this.get=function(id){var scope=this;return $http.get("/api/saas/app/"+id).then(function(res){return scope.ret(res.data)},function(res){throw new PException(res.data)})},this.create=function(t){var scope=this;return $http({method:"POST",url:"/api/saas/app/create?XDEBUG_SESSION_START=ECLIPSE_DBGP&KEY=14513358957011",data:$httpParamSerializerJQLike(t),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(res){return scope.ret(res.data)},function(res){throw new PException(res.data)})},this.tenants=function($params){var scope=this;return $http({method:"GET",url:"/api/saas/app/list",params:$params.getParameter()}).then(function(res){var page=new PaginatorPage(res.data);page.items=[];for(var i=0;i<page.counts;i++){var t=scope.ret(res.data.items[i]);page.items.push(t)}return page},function(data){throw new PException(data)})},this.mine=function(param){param||(param=new PaginatorParameter);var scope=this;return $http({method:"GET",url:"/api/saas/app/userList",params:param.getParameter()}).then(function(res){var page=new PaginatorPage(res.data);page.items=[];for(var i=0;i<page.counts;i++){var t=scope.ret(res.data.items[i]);page.items.push(t)}return page},function(data){throw new PException(data)})}}).run(function($window,$act,$tenant){$act.command({id:"pluf.saas.lunch",category:"saas"}).commandHandler({commandId:"pluf.saas.lunch",handle:function(){if(arguments.length<1)throw new PException("no app found");var a=arguments[0];return $tenant.get(a).then(function(tenant){return tenant.defaultApplication()}).then(function(app){return app.run()})}}).command({id:"pluf.saas.app.lunch",category:"saas"}).commandHandler({commandId:"pluf.saas.app.lunch",handle:function(){if(arguments.length<1)throw new PException("no app found");var a=arguments[0];return $tenant.session().then(function(tenant){return tenant.app(a)}).then(function(app){return app.run()})}})});